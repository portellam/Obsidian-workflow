/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var et=Object.defineProperty;var Mt=Object.getOwnPropertyDescriptor;var bt=Object.getOwnPropertyNames;var Tt=Object.prototype.hasOwnProperty;var wt=(l,e)=>{for(var t in e)et(l,t,{get:e[t],enumerable:!0})},St=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of bt(e))!Tt.call(l,r)&&r!==t&&et(l,r,{get:()=>e[r],enumerable:!(i=Mt(e,r))||i.enumerable});return l};var Ct=l=>St(et({},"__esModule",{value:!0}),l);var Lt={};wt(Lt,{default:()=>Je});module.exports=Ct(Lt);var Ze=require("obsidian");var st=require("obsidian");var D={MAX_HISTORY_ENTRIES:50,MAX_BULK_OPERATIONS:20,DUPLICATE_CHECK_WINDOW_MS:1e3,DEFAULT_RETENTION_POLICY:{value:30,unit:"days"}},b={DEFAULT_DURATIONS:{info:8e3,error:15e3,update:15e3,success:5e3,warning:1e4},DEFAULT_TITLES:{info:"NoteMover info:",error:"NoteMover error:",update:"NoteMover update:",success:"NoteMover success:",warning:"NoteMover warning:"},DURATION_OVERRIDE:5e3},d={DEFAULT_SETTINGS:{enablePeriodicMovement:!1,periodicMovementInterval:5,enableOnEditTrigger:!1,filter:[],rules:[],retentionPolicy:D.DEFAULT_RETENTION_POLICY},PLACEHOLDER_TEXTS:{FOLDER_PATH:"Example: folder1/folder2",INTERVAL:"5",FILTER:"Filter (z.B. tag:, fileName:, path:, property:, ...)",CRITERIA:"Criteria (z.B. tag:, fileName:, path:, property:, ...)",PATH:"Path"},UI_TEXTS:{UNDO_ALL:"Undo All",UNDO:"Undo",CLEAR_HISTORY:"Clear history",CLEAR_HISTORY_TITLE:"Clear History",CLEAR_HISTORY_MESSAGE:"Are you sure you want to clear the history?<br/><br/>This action cannot be undone.",CLEAR_HISTORY_CONFIRM:"Clear History",CLEAR_HISTORY_CANCEL:"Cancel",EXPORT_SETTINGS:"Export Settings",IMPORT_SETTINGS:"Import Settings",EXPORT_SETTINGS_TITLE:"Export Settings",EXPORT_SETTINGS_MESSAGE:"This will download your current settings as a JSON file.",EXPORT_SETTINGS_CONFIRM:"Export",EXPORT_SETTINGS_CANCEL:"Cancel",IMPORT_SETTINGS_TITLE:"Import Settings",IMPORT_SETTINGS_MESSAGE:"This will replace your current settings with the imported ones.<br/><br/>This action cannot be undone. Make sure you have a backup of your current settings.",IMPORT_SETTINGS_CONFIRM:"Import",IMPORT_SETTINGS_CANCEL:"Cancel",IMPORT_SUCCESS:"Settings imported successfully",IMPORT_ERROR:"Failed to import settings",EXPORT_SUCCESS:"Settings exported successfully",EXPORT_ERROR:"Failed to export settings",INVALID_FILE:"Invalid file format. Please select a valid JSON file.",VALIDATION_ERRORS:"Settings validation failed",TIME_FILTER_ALL:"All",TIME_FILTER_TODAY:"Today",TIME_FILTER_WEEK:"This Week",TIME_FILTER_MONTH:"This Month",TIME_FILTER_LABEL:"Show entries from:",RETENTION_POLICY_TITLE:"Retention Policy",RETENTION_POLICY_DESC:"Configure how long history entries should be kept",RETENTION_POLICY_VALUE_LABEL:"Keep entries for:",RETENTION_POLICY_UNIT_LABEL:"Unit:",RETENTION_POLICY_DAYS:"Days",RETENTION_POLICY_WEEKS:"Weeks",RETENTION_POLICY_MONTHS:"Months"}},nt={TIME_CONVERSIONS:{MINUTES_TO_MILLISECONDS:60*1e3},SUGGESTION_LIMITS:{FOLDER_SUGGESTIONS:1e3}};var g=class{static show(e,t,i={}){var c,u;let r=(c=i.duration)!=null?c:b.DEFAULT_DURATIONS[e],n=new st.Notice("",r),s=n.noticeEl,o=document.createElement("b");o.textContent=b.DEFAULT_TITLES[e],s.appendChild(o),s.appendChild(document.createElement("br"));let a=document.createElement("span");if(a.textContent=t,s.appendChild(a),i.showUndoButton&&i.onUndo){let p=document.createElement("button");p.textContent=(u=i.undoText)!=null?u:"Undo",p.className="mod-warning noteMover-notice-undo-button",p.onclick=()=>{try{i.onUndo(),n.hide()}catch(y){console.error("Error in undo button click handler:",y),this.show("error",`Error undoing action: ${y instanceof Error?y.message:String(y)}`)}},s.appendChild(p)}return n}static info(e,t){return this.show("info",e,t)}static error(e,t){return this.show("error",e,t)}static update(e,t){return this.show("update",e,t)}static success(e,t){return this.show("success",e,t)}static warning(e,t){return this.show("warning",e,t)}static showWithUndo(e,t,i,r,n){return this.show(e,t,{...n,showUndoButton:!0,onUndo:i,undoText:r})}};function v(l,e){let t=e?`${e}: ${l}`:l;return new Error(t)}function h(l,e,t=!0){let i=l instanceof Error?l.message:typeof l=="object"&&l!==null?JSON.stringify(l):String(l),r=e?`${e}: ${i}`:i;if(g.error(r),t)throw l instanceof Error?l:new Error(i)}function ot(l){return!l||l==="/"?"":(l=l.replace(/\/+/g,"/"),l.endsWith("/")&&(l=l.slice(0,-1)),l.startsWith("/")&&(l=l.slice(1)),l)}function Z(l,e){if(!l||l==="/"||l==="")return e;let t=ot(l);return t?t+"/"+e:e}function Q(l){if(!l)return"";let e=l.lastIndexOf("/");return e===-1?"":l.substring(0,e)}async function ee(l,e){if(!e||e==="/"||e==="")return!0;let t=ot(e);if(!t)return!0;try{return await l.vault.adapter.exists(t)||await l.vault.createFolder(t),!0}catch(i){return console.error(`Failed to create folder ${t}:`,i),!1}}var Se=require("obsidian");var T=class{constructor(e){this.app=e}async extractFileMetadata(e){try{let t=e.name,i=e.path,r=e.stat&&e.stat.ctime?new Date(e.stat.ctime):null,n=e.stat&&e.stat.mtime?new Date(e.stat.mtime):null,s=this.app.metadataCache.getFileCache(e),o=(0,Se.getAllTags)(s||{})||[],a=(s==null?void 0:s.frontmatter)||{},c="";try{c=await this.app.vault.read(e)}catch(u){}return{fileName:t,filePath:i,tags:o,properties:a,fileContent:c,createdAt:r,updatedAt:n}}catch(t){return h(t,`Error extracting metadata for file '${e.path}'`,!1),{fileName:e.name,filePath:e.path,tags:[],properties:{},fileContent:"",createdAt:null,updatedAt:null}}}async extractBasicMetadata(e){try{let t=e.name,i=e.path,r=e.stat&&e.stat.ctime?new Date(e.stat.ctime):null,n=e.stat&&e.stat.mtime?new Date(e.stat.mtime):null,s=this.app.metadataCache.getFileCache(e),o=(0,Se.getAllTags)(s||{})||[],a=(s==null?void 0:s.frontmatter)||{};return{fileName:t,filePath:i,tags:o,properties:a,createdAt:r,updatedAt:n}}catch(t){return h(t,`Error extracting basic metadata for file '${e.path}'`,!1),{fileName:e.name,filePath:e.path,tags:[],properties:{},createdAt:null,updatedAt:null}}}extractAllTags(){let e=new Set;return this.app.vault.getMarkdownFiles().forEach(i=>{try{let r=this.app.metadataCache.getFileCache(i);((0,Se.getAllTags)(r||{})||[]).forEach(s=>e.add(s))}catch(r){}}),e}parseListProperty(e){return e==null?[]:Array.isArray(e)?e.map(t=>String(t).trim()).filter(t=>t.length>0):typeof e=="string"?e.split(/[,\n]/).map(i=>i.trim()).filter(i=>i.length>0):[String(e).trim()].filter(t=>t.length>0)}isListProperty(e){return e==null?!1:Array.isArray(e)?e.length>1:typeof e=="string"?/[,\n]/.test(e)&&e.split(/[,\n]/).length>1:!1}async extractFileMetadataV2(e){try{let t=await this.extractFileMetadata(e),i=this.app.metadataCache.getFileCache(e),r=e.extension||"",n=[];i!=null&&i.links&&i.links.forEach(a=>{a.link&&typeof a.link=="string"&&n.push(a.link)});let s=[];i!=null&&i.embeds&&i.embeds.forEach(a=>{a.link&&typeof a.link=="string"&&s.push(a.link)});let o=[];return i!=null&&i.headings&&i.headings.forEach(a=>{a.heading&&typeof a.heading=="string"&&o.push(a.heading)}),{...t,extension:r,links:n,embeds:s,headings:o}}catch(t){return h(t,`Error extracting V2 metadata for file '${e.path}'`,!1),{...await this.extractFileMetadata(e),extension:"",links:[],embeds:[],headings:[]}}}};var te=class{constructor(e){this.metadataExtractor=e||new T({})}matchTag(e,t){return e.includes(t)?!0:e.some(i=>!!i.startsWith(t+"/"))}matchFileName(e,t){if(e===t)return!0;if(t.includes("*")||t.includes("?")){let i=t.replace(/[.+^${}()|[\]\\]/g,"\\$&");return i=i.replace(/\*/g,".*").replace(/\?/g,"."),new RegExp(`^${i}$`,"i").test(e)}return e.toLowerCase()===t.toLowerCase()}matchProperty(e,t){let i=t.indexOf(":");if(i===-1){let r=t.trim();return e.hasOwnProperty(r)&&e[r]!==void 0&&e[r]!==null}else{let r=t.substring(0,i).trim(),n=t.substring(i+1).trim();if(!e.hasOwnProperty(r))return!1;let s=e[r];if(s==null)return!1;if(this.metadataExtractor.isListProperty(s))return this.matchListProperty(s,n);let o=String(s).toLowerCase(),a=n.toLowerCase();return o===a}}matchListProperty(e,t){let i=this.metadataExtractor.parseListProperty(e),r=t.toLowerCase();return i.some(n=>n.toLowerCase()===r)}evaluateCriteria(e,t){let i=t.match(/^([a-zA-Z_]+):\s*(.*)$/);if(!i)return!1;let r=i[1],n=i[2],{tags:s,fileName:o,filePath:a,createdAt:c,updatedAt:u,properties:p,fileContent:y}=e;switch(r){case"tag":return this.matchTag(s,n);case"fileName":return this.matchFileName(o,n);case"path":return a===n||a.startsWith(n+"/");case"content":return y.includes(n);case"created_at":return c?c.toISOString().startsWith(n):!1;case"updated_at":return u?u.toISOString().startsWith(n):!1;case"property":return this.matchProperty(p,n);default:return!1}}evaluateFilter(e,t){if(t.length===0)return!0;for(let i of t)if(this.evaluateCriteria(e,i))return!1;return!0}findMatchingRule(e,t){let i=t.map((r,n)=>{let s=r.criteria.match(/^tag:\s*(.*)$/),o=s?(s[1].match(/\//g)||[]).length:0;return{rule:r,index:n,specificity:o}}).filter(r=>this.evaluateCriteria(e,r.rule.criteria));return i.length===0?null:(i.sort((r,n)=>r.index!==n.index?r.index-n.index:n.specificity-r.specificity),i[0].rule)}sortRulesBySpecificity(e){return e.slice().sort((t,i)=>{let r=t.criteria.trim(),n=i.criteria.trim(),s=r.match(/^tag:\s*(.*)$/),o=n.match(/^tag:\s*(.*)$/);if(s&&o){let a=(s[1].match(/\//g)||[]).length;return(o[1].match(/\//g)||[]).length-a}return 0})}getFilterMatchDetails(e,t){if(t.length===0)return{passes:!0};for(let i of t)if(this.evaluateCriteria(e,i))return{passes:!1,blockingFilter:i,blockReason:"Blocked by blacklist filter"};return{passes:!0}}};var Ce=class{constructor(e,t){this.app=e;this.defaultFolder=t;this.rules=[];this.filter=[];this.metadataExtractor=new T(e),this.ruleMatcher=new te(this.metadataExtractor)}setRules(e){this.rules=e}setFilter(e){this.filter=e}async moveFileBasedOnTags(e,t=!1){try{let i=await this.metadataExtractor.extractFileMetadata(e);if(!t&&!this.ruleMatcher.evaluateFilter(i,this.filter))return null;let r=this.ruleMatcher.findMatchingRule(i,this.rules);return r?r.path:null}catch(i){return h(i,`Error processing rules for file '${e.path}'`,!1),null}}async generatePreviewForFile(e,t=!1){try{let i=await this.metadataExtractor.extractFileMetadata(e),{tags:r,fileName:n,filePath:s}=i;if(!t){let a=this.ruleMatcher.getFilterMatchDetails(i,this.filter);if(!a.passes)return{fileName:n,currentPath:s,targetPath:null,willBeMoved:!1,blockReason:a.blockReason,blockingFilter:a.blockingFilter,tags:r}}let o=this.ruleMatcher.findMatchingRule(i,this.rules);if(o){let a=Z(o.path,n);return s===a?{fileName:n,currentPath:s,targetPath:o.path,willBeMoved:!1,blockReason:"File is already in the correct folder",matchedRule:o.criteria,tags:r}:{fileName:n,currentPath:s,targetPath:o.path,willBeMoved:!0,matchedRule:o.criteria,tags:r}}return{fileName:n,currentPath:s,targetPath:null,willBeMoved:!1,blockReason:"No matching rule found",tags:r}}catch(i){return h(i,`Error generating preview for file '${e.path}'`,!1),{fileName:e.name,currentPath:e.path,targetPath:null,willBeMoved:!1,blockReason:`Error: ${i instanceof Error?i.message:String(i)}`,tags:[]}}}async generateMovePreview(e,t,i){let r=[];for(let n of e){let s=await this.generatePreviewForFile(n,!i);s.willBeMoved&&r.push(s)}return{successfulMoves:r,totalFiles:e.length,settings:{isFilterWhitelist:!1}}}};var Ie=class{constructor(e){this.metadataExtractor=e,this.regexCache=new Map}findMatchingRule(e,t){for(let i of t){if(!i.active||i.triggers.length===0)continue;let r=[];for(let n of i.triggers){let s=this.evaluateTrigger(e,n);r.push(s)}if(this.evaluateAggregation(r,i.aggregation))return i}return null}evaluateTrigger(e,t){switch(t.criteriaType){case"fileName":return this.evaluateTextOperator(e.fileName,t.operator,t.value);case"folder":let i=e.filePath.split("/").slice(0,-1).join("/")||"";return this.evaluateTextOperator(i,t.operator,t.value);case"extension":let r=e.extension||"";return this.evaluateTextOperator(r,t.operator,t.value);case"headings":let n=e.headings||[];return this.evaluateListOperator(n,t.operator,t.value);case"tag":return this.evaluateListOperator(e.tags,t.operator,t.value);case"links":let s=e.links||[];return this.evaluateListOperator(s,t.operator,t.value);case"embeds":let o=e.embeds||[];return this.evaluateListOperator(o,t.operator,t.value);case"created_at":return this.evaluateDateOperator(e.createdAt,t.operator,t.value);case"modified_at":return this.evaluateDateOperator(e.updatedAt,t.operator,t.value);case"properties":return this.evaluatePropertyOperator(e.properties,t);default:return!1}}evaluateAggregation(e,t){if(e.length===0)return!1;switch(t){case"all":return e.every(i=>i===!0);case"any":return e.some(i=>i===!0);case"none":return e.every(i=>i===!1);default:return!1}}evaluateTextOperator(e,t,i){let r=e.toLowerCase(),n=i.toLowerCase();switch(t){case"is":return r===n;case"is not":return r!==n;case"contains":return r.includes(n);case"does not contain":return!r.includes(n);case"starts with":return r.startsWith(n);case"does not starts with":return!r.startsWith(n);case"ends with":return r.endsWith(n);case"does not ends with":return!r.endsWith(n);case"match regex":let s=this.getRegex(i);return s!==null?s.test(e):!1;case"does not match regex":let o=this.getRegex(i);return o!==null?!o.test(e):!0;default:return!1}}evaluateListOperator(e,t,i){let r=i.toLowerCase();switch(t){case"includes item":return e.some(p=>p.toLowerCase()===r);case"does not include item":return!e.some(p=>p.toLowerCase()===r);case"all are":return e.length>0&&e.every(p=>p.toLowerCase()===r);case"all start with":return e.length>0&&e.every(p=>p.toLowerCase().startsWith(r));case"all end with":return e.length>0&&e.every(p=>p.toLowerCase().endsWith(r));case"all match regex":let n=this.getRegex(i);return n!==null&&e.length>0&&e.every(p=>n.test(p));case"any contain":return e.some(p=>p.toLowerCase().includes(r));case"any end with":return e.some(p=>p.toLowerCase().endsWith(r));case"any match regex":let s=this.getRegex(i);return s!==null?e.some(p=>s.test(p)):!1;case"none contain":return!e.some(p=>p.toLowerCase().includes(r));case"none start with":return!e.some(p=>p.toLowerCase().startsWith(r));case"none end with":return!e.some(p=>p.toLowerCase().endsWith(r));case"count is":let o=this.parseNumericValue(i);return o!==null&&e.length===o;case"count is not":let a=this.parseNumericValue(i);return a!==null&&e.length!==a;case"count is less than":let c=this.parseNumericValue(i);return c!==null&&e.length<c;case"count is more than":let u=this.parseNumericValue(i);return u!==null&&e.length>u;default:return!1}}evaluateDateOperator(e,t,i){if(!e)return!1;let r=new Date,n=this.parseDate(i);switch(t){case"is":return n?e.getTime()===n.getTime():!1;case"is before":return n?e<n:!1;case"is after":return n?e>n:!1;case"time is before":return n?e.getTime()<n.getTime():!1;case"time is after":return n?e.getTime()>n.getTime():!1;case"time is before now":return e<r;case"time is after now":return e>r;case"date is":return n?this.isSameDate(e,n):!1;case"date is not":return n?!this.isSameDate(e,n):!0;case"date is before":return n?this.isDateBefore(e,n):!1;case"date is after":return n?this.isDateAfter(e,n):!1;case"date is today":return this.isSameDate(e,r);case"date is not today":return!this.isSameDate(e,r);case"is under X days ago":let s=this.parseNumericValue(i);return s!==null?this.isDaysAgo(e,s,"under"):!1;case"is over X days ago":let o=this.parseNumericValue(i);return o!==null?this.isDaysAgo(e,o,"over"):!1;case"day of week is":return this.isDayOfWeek(e,i);case"day of week is not":return!this.isDayOfWeek(e,i);case"day of week is before":return this.isDayOfWeekBefore(e,i);case"day of week is after":return this.isDayOfWeekAfter(e,i);case"day of month is":let a=this.parseNumericValue(i);return a!==null&&e.getDate()===a;case"day of month is not":let c=this.parseNumericValue(i);return c!==null&&e.getDate()!==c;case"day of month is before":let u=this.parseNumericValue(i);return u!==null&&e.getDate()<u;case"day of month is after":let p=this.parseNumericValue(i);return p!==null&&e.getDate()>p;case"month is":let y=this.parseNumericValue(i);return y!==null&&e.getMonth()+1===y;case"month is not":let M=this.parseNumericValue(i);return M!==null&&e.getMonth()+1!==M;case"month is before":let E=this.parseNumericValue(i);return E!==null&&e.getMonth()+1<E;case"month is after":let S=this.parseNumericValue(i);return S!==null&&e.getMonth()+1>S;case"year is":let f=this.parseNumericValue(i);return f!==null&&e.getFullYear()===f;case"year is not":let O=this.parseNumericValue(i);return O!==null&&e.getFullYear()!==O;case"year is before":let H=this.parseNumericValue(i);return H!==null&&e.getFullYear()<H;case"year is after":let K=this.parseNumericValue(i);return K!==null&&e.getFullYear()>K;default:return!1}}evaluatePropertyOperator(e,t){if(!t.propertyName)return!1;let i=e[t.propertyName],r=t.propertyType||"text";switch(t.operator){case"has any value":return i!=null&&i!=="";case"has no value":return i==null||i==="";case"property is present":return e.hasOwnProperty(t.propertyName);case"property is missing":return!e.hasOwnProperty(t.propertyName)}switch(r){case"text":return this.evaluateTextPropertyOperator(i,t.operator,t.value);case"number":return this.evaluateNumberPropertyOperator(i,t.operator,t.value);case"list":return this.evaluateListPropertyOperator(i,t.operator,t.value);case"date":return this.evaluateDatePropertyOperator(i,t.operator,t.value);case"checkbox":return this.evaluateCheckboxPropertyOperator(i,t.operator,t.value);default:return!1}}evaluateTextPropertyOperator(e,t,i){if(e==null)return!1;let r=String(e);return this.evaluateTextOperator(r,t,i)}evaluateNumberPropertyOperator(e,t,i){if(e==null)return!1;let r=Number(e),n=this.parseNumericValue(i);if(isNaN(r)||n===null)return!1;switch(t){case"equals":return r===n;case"does not equal":return r!==n;case"is less than":return r<n;case"is more than":return r>n;case"is divisible by":return n!==0&&r%n===0;case"is not divisible by":return n!==0&&r%n!==0;default:return!1}}evaluateListPropertyOperator(e,t,i){if(e==null)return!1;let r=this.metadataExtractor.parseListProperty(e);return this.evaluateListOperator(r,t,i)}evaluateDatePropertyOperator(e,t,i){if(e==null)return!1;let r=null;return e instanceof Date?r=e:typeof e=="string"?r=new Date(e):typeof e=="number"&&(r=new Date(e)),!r||isNaN(r.getTime())?!1:this.evaluateDateOperator(r,t,i)}evaluateCheckboxPropertyOperator(e,t,i){if(e==null)return!1;let r=!!e;switch(t){case"is true":return r===!0;case"is false":return r===!1;default:return!1}}getRegex(e){if(this.regexCache.has(e))return this.regexCache.get(e);try{let t=new RegExp(e,"i");return this.regexCache.set(e,t),t}catch(t){return null}}parseNumericValue(e){let t=Number(e);return isNaN(t)?null:t}parseDate(e){let t=new Date(e);return isNaN(t.getTime())?null:t}isSameDate(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}isDateBefore(e,t){let i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i<r}isDateAfter(e,t){let i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),r=new Date(t.getFullYear(),t.getMonth(),t.getDate());return i>r}isDaysAgo(e,t,i){let n=new Date().getTime()-e.getTime(),s=Math.floor(n/(1e3*60*60*24));return i==="under"?s<t:s>t}isDayOfWeek(e,t){let r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(t.toLowerCase());return r!==-1&&e.getDay()===r}isDayOfWeekBefore(e,t){let r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(t.toLowerCase());return r!==-1&&e.getDay()<r}isDayOfWeekAfter(e,t){let r=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].indexOf(t.toLowerCase());return r!==-1&&e.getDay()>r}};var Oe=class{constructor(e,t){this.app=e;this.defaultFolder=t;this.rules=[];this.filter=[];this.metadataExtractor=new T(e),this.ruleMatcherV2=new Ie(this.metadataExtractor),this.ruleMatcherV1=new te(this.metadataExtractor)}setRules(e){this.rules=e}setFilter(e){this.filter=e}async moveFileBasedOnTags(e,t=!1){try{let i=await this.metadataExtractor.extractFileMetadataV2(e);if(!t&&!this.ruleMatcherV1.evaluateFilter(i,this.filter))return null;let r=this.ruleMatcherV2.findMatchingRule(i,this.rules);return r?r.destination:null}catch(i){return h(i,`Error processing V2 rules for file '${e.path}'`,!1),null}}async generatePreviewForFile(e,t=!1){try{let i=await this.metadataExtractor.extractFileMetadataV2(e),{tags:r,fileName:n,filePath:s}=i;if(!t){let a=this.ruleMatcherV1.getFilterMatchDetails(i,this.filter);if(!a.passes)return{fileName:n,currentPath:s,targetPath:null,willBeMoved:!1,blockReason:a.blockReason,blockingFilter:a.blockingFilter,tags:r}}let o=this.ruleMatcherV2.findMatchingRule(i,this.rules);if(o){let a=Z(o.destination,n);return s===a?{fileName:n,currentPath:s,targetPath:o.destination,willBeMoved:!1,blockReason:"File is already in the correct folder",matchedRule:o.name,tags:r}:{fileName:n,currentPath:s,targetPath:o.destination,willBeMoved:!0,matchedRule:o.name,tags:r}}return{fileName:n,currentPath:s,targetPath:null,willBeMoved:!1,blockReason:"No matching rule found",tags:r}}catch(i){return h(i,`Error generating V2 preview for file '${e.path}'`,!1),{fileName:e.name,currentPath:e.path,targetPath:null,willBeMoved:!1,blockReason:`Error: ${i instanceof Error?i.message:String(i)}`,tags:[]}}}async generateMovePreview(e,t,i){let r=[];for(let n of e){let s=await this.generatePreviewForFile(n,!i);s.willBeMoved&&r.push(s)}return{successfulMoves:r,totalFiles:e.length,settings:{isFilterWhitelist:!1}}}getActiveRuleCount(){return this.rules.filter(e=>e.active).length}getTotalRuleCount(){return this.rules.length}validateRules(){let e=[];for(let t=0;t<this.rules.length;t++){let i=this.rules[t];i.active&&i.triggers.length===0&&e.push(`Rule "${i.name}" (index ${t}) is active but has no triggers`),(!i.name||i.name.trim()==="")&&e.push(`Rule at index ${t} has no name`),(!i.destination||i.destination.trim()==="")&&e.push(`Rule "${i.name}" has no destination`)}return e}};var xe=class{constructor(e){this.plugin=e;this.ruleManager=new Ce(e.app,"/"),this.ruleManagerV2=new Oe(e.app,"/"),this.updateRuleManager()}updateRuleManager(){if(this.plugin.settings.settings.enableRuleV2===!0){let e=Array.isArray(this.plugin.settings.settings.rulesV2)?this.plugin.settings.settings.rulesV2:[];this.ruleManagerV2.setRules(e),this.ruleManagerV2.setFilter(this.plugin.settings.settings.filters.filter.map(t=>t.value))}else this.ruleManager.setRules(this.plugin.settings.settings.rules),this.ruleManager.setFilter(this.plugin.settings.settings.filters.filter.map(e=>e.value))}async addFileToBlacklist(e){try{let t=`fileName: ${e}`;if(this.plugin.settings.settings.filters.filter.some(i=>i.value===t)){g.warning(`File "${e}" is already in the blacklist.`);return}this.plugin.settings.settings.filters.filter.push({value:t}),await this.plugin.save_settings(),this.updateRuleManager(),g.success(`File "${e}" added to blacklist.`)}catch(t){g.error(`Error adding file to blacklist: ${t instanceof Error?t.message:String(t)}`)}}async setup(){}async moveFileBasedOnTags(e,t,i=!1){let{app:r}=this.plugin,n=e.path;try{let s=t,o=null;if(this.plugin.settings.settings.enableRuleV2===!0?o=await this.ruleManagerV2.moveFileBasedOnTags(e,i):o=await this.ruleManager.moveFileBasedOnTags(e,i),o===null)return;s=o;let a=Z(s,e.name);if(n===a)return;if(!await ee(r,s))throw v(`Failed to create target folder: ${s}`);this.plugin.historyManager.markPluginMoveStart();try{await r.fileManager.renameFile(e,a),this.plugin.historyManager.addEntry({sourcePath:n,destinationPath:a,fileName:e.name})}finally{this.plugin.historyManager.markPluginMoveEnd()}}catch(s){h(s,`Error moving file '${e.path}'`)}}async moveAllFiles(e){let{app:t}=this.plugin,i=await t.vault.getFiles();if(i.length===0){e.showNotifications&&e.operationType==="bulk"&&g.info("No files found in vault");return}let r=this.plugin.historyManager.startBulkOperation(e.operationType),n=0,s=0;try{for(let o of i)try{await this.moveFileBasedOnTags(o,"/"),n++}catch(a){s++;let c=e.operationType==="periodic"?`Error moving file '${o.path}' during periodic movement`:`Error moving file '${o.path}'`;h(a,c,!1)}if(n>0&&e.showNotifications)if(e.operationType==="bulk"){let o=n+s,a=s>0?`Moved ${n}/${o} files. ${s} files had errors.`:`Successfully moved ${n} files`;g.showWithUndo("info",`Bulk Operation: ${a}`,async()=>{await this.plugin.historyManager.undoBulkOperation(r)?g.success(`Bulk operation undone: ${n} files moved back`,{duration:b.DURATION_OVERRIDE}):g.warning("Could not undo all moves. Check individual files in history.",{duration:b.DURATION_OVERRIDE})},d.UI_TEXTS.UNDO_ALL)}else g.info(`Periodic movement: Successfully moved ${n} files`)}finally{this.plugin.historyManager.endBulkOperation()}}async moveAllFilesInVault(){await this.moveAllFiles({createFolders:!0,showNotifications:!0,operationType:"bulk"})}async moveAllFilesInVaultPeriodic(){await this.moveAllFiles({createFolders:!1,showNotifications:!0,operationType:"periodic"})}async moveFocusedNoteToDestination(){let{app:e}=this.plugin,t=e.workspace.getActiveFile();if(!t){h(v("No file is open"),"moveFocusedNoteToDestination",!1);return}try{await this.moveFileBasedOnTags(t,"/",!1),g.showWithUndo("info",`Note "${t.name}" has been moved`,async()=>{try{g.info(`Attempting to undo move for file: ${t.name}`),await this.plugin.historyManager.undoLastMove(t.name)?g.success(`Note "${t.name}" has been moved back`,{duration:3e3}):g.warning(`Could not undo move for "${t.name}"`,{duration:3e3})}catch(i){h(i,"Error in undo button click handler",!1)}},"Undo")}catch(i){h(i,"moveFocusedNoteToDestination",!1);return}}async generateVaultMovePreview(){let{app:e}=this.plugin,t=await e.vault.getFiles();return this.plugin.settings.settings.enableRuleV2===!0?await this.ruleManagerV2.generateMovePreview(t,!0,!0):await this.ruleManager.generateMovePreview(t,!0,!0)}async generateActiveNotePreview(){let{app:e}=this.plugin,t=e.workspace.getActiveFile();return t?this.plugin.settings.settings.enableRuleV2===!0?await this.ruleManagerV2.generateMovePreview([t],!0,!0):await this.ruleManager.generateMovePreview([t],!0,!0):null}};var w=require("obsidian");var Re=require("obsidian");var ie=require("obsidian"),m=class{static isMobile(){return ie.Platform.isMobile||ie.Platform.isIosApp||ie.Platform.isAndroidApp}static isTablet(){return this.isMobile()&&window.innerWidth>=600}static isPhone(){return this.isMobile()&&!this.isTablet()}static addMobileClass(e){this.isMobile()?(e.addClass("is-mobile"),this.isPhone()?e.addClass("is-phone"):e.addClass("is-tablet")):e.addClass("is-desktop")}static getMobileClass(){return this.isMobile()?this.isPhone()?"is-mobile is-phone":"is-mobile is-tablet":"is-desktop"}static createMoveButton(e,t,i,r=!1){if(r)return null;let n=e.createEl("button",{cls:`noteMover-mobile-move-button noteMover-mobile-move-${t}-button`});return(0,ie.setIcon)(n,t==="up"?"chevron-up":"chevron-down"),n.addEventListener("click",async()=>{await i()}),n}static createActionButton(e,t,i,r={}){let n=e.createEl("button",{cls:"noteMover-mobile-action-btn",text:t});return r.isPrimary?(n.addClass("mod-cta"),n.style.background="var(--interactive-accent)",n.style.color="var(--text-on-accent)"):r.isDanger&&n.addClass("noteMover-mobile-delete-btn"),n.addEventListener("click",async()=>{await i()}),n}};var x=class extends Re.Modal{constructor(e,t={}){super(e),this.options={autoFocus:!0,focusSelector:".mod-cta",...t}}onOpen(){let{contentEl:e}=this;this.clearContent(),this.addCssClass(),this.addMobileClasses(),this.setModalSize(),this.createTitle(),this.createContent(),this.setupAutoFocus(),this.resetScrollPosition()}resetScrollPosition(){let e=()=>{var i;this.contentEl&&(this.contentEl.scrollTop=0);let t=(i=this.contentEl)==null?void 0:i.parentElement;if(t){t.scrollTop=0;let r=t.parentElement;r&&(r.scrollTop=0)}};e(),requestAnimationFrame(()=>{e(),setTimeout(()=>{e()},50)})}onClose(){this.clearContent()}clearContent(){let{contentEl:e}=this;e.empty()}addCssClass(){let{contentEl:e}=this;this.options.cssClass&&e.addClass(this.options.cssClass)}addMobileClasses(){let e=this.contentEl.parentElement;e&&(m.addMobileClass(e),m.addMobileClass(this.contentEl))}setModalSize(){let e=this.contentEl.parentElement;e&&this.options.size&&(e.classList.remove("noteMover-modal-size-small","noteMover-modal-size-medium","noteMover-modal-size-large"),m.isMobile()?e.classList.add("noteMover-modal-size-mobile"):e.classList.add(`noteMover-modal-size-${this.options.size}`))}createTitle(){if(!this.options.title)return;let{contentEl:e}=this;if(this.options.titleIcon){let t=e.createEl("div",{cls:"noteMover-modal-title-container"}),i=t.createEl("span",{cls:"noteMover-modal-title-icon"});i.innerHTML=this.options.titleIcon,t.createEl("h2",{text:this.options.title,cls:"noteMover-modal-title"})}else e.createEl("h2",{text:this.options.title,cls:"noteMover-modal-title"})}setupAutoFocus(){!this.options.autoFocus||!this.options.focusSelector||setTimeout(()=>{let e=this.contentEl.querySelector(this.options.focusSelector);e&&typeof e.focus=="function"&&(e.focus(),this.resetScrollPosition())},10)}createButtonContainer(e,t="noteMover-modal-button-container"){return e.createEl("div",{cls:t})}createButton(e,t,i,r={}){new Re.Setting(e).addButton(n=>{n.setButtonText(t),r.icon&&n.setIcon(r.icon),r.tooltip&&n.setTooltip(r.tooltip),r.isWarning&&n.setWarning(),r.isPrimary&&n.setCta(),n.onClick(i)})}createSection(e,t="noteMover-modal-section"){return e.createEl("div",{cls:t})}};var De=class extends x{constructor(t,i,r,n={}){super(t,{cssClass:"note-mover-history-modal",size:"large",...n});this.historyManager=i;this.plugin=r;this.currentTimeFilter="all"}createContent(){let{contentEl:t}=this;this.createTimeFilterDropdown(t);let i=this.historyManager.getFilteredHistory(this.currentTimeFilter),r=this.historyManager.getFilteredBulkOperations(this.currentTimeFilter);if(i.length===0&&r.length===0){t.createEl("p",{text:"No history entries available for the selected time period."});return}let n=t.createEl("div",{cls:"noteMover-history-list"}),s=[];r.forEach(a=>{s.push({type:"bulk",data:a})}),i.filter(a=>!a.bulkOperationId).forEach(a=>{s.push({type:"single",data:a})}),s.sort((a,c)=>c.data.timestamp-a.data.timestamp),s.forEach(a=>{a.type==="bulk"?this.createBulkOperationEntry(n,a.data):this.createSingleEntry(n,a.data)})}createTimeFilterDropdown(t){let i=m.isMobile(),r=t.createEl("div",{cls:i?"noteMover-time-filter-container noteMover-time-filter-container-mobile":"noteMover-time-filter-container"}),n=new w.Setting(r).setName(d.UI_TEXTS.TIME_FILTER_LABEL).addDropdown(s=>{if(s.addOption("all",d.UI_TEXTS.TIME_FILTER_ALL).addOption("today",d.UI_TEXTS.TIME_FILTER_TODAY).addOption("week",d.UI_TEXTS.TIME_FILTER_WEEK).addOption("month",d.UI_TEXTS.TIME_FILTER_MONTH).setValue(this.currentTimeFilter).onChange(o=>{this.currentTimeFilter=o,this.refreshContent()}),i){let o=s.selectEl;o.style.minHeight="48px",o.style.fontSize="16px"}})}refreshContent(){let{contentEl:t}=this;t.empty(),this.createContent()}createBulkOperationEntry(t,i){let r=m.isMobile(),n=t.createEl("div",{cls:r?"noteMover-history-entry noteMover-bulk-operation noteMover-history-entry-mobile":"noteMover-history-entry noteMover-bulk-operation"}),s=n.createEl("div",{cls:"noteMover-bulk-header"}),a=new Date(i.timestamp).toLocaleString("en-US"),c=i.operationType==="bulk"?"Bulk Move":"Periodic Move",u=i.operationType==="bulk"?"\u{1F4E6}":"\u{1F550}";s.createEl("div",{cls:"noteMover-bulk-operation-info",text:`${u} ${c}: ${i.totalFiles} files - ${a}`});let p=n.createEl("details",{cls:"noteMover-bulk-details"});p.open=!0;let y=p.createEl("summary",{text:"Hide files"}),M=p.createEl("div",{cls:"noteMover-bulk-files-list"});p.addEventListener("toggle",()=>{y.textContent=p.open?"Hide files":"Show files"}),[...i.entries].sort((f,O)=>f.timestamp-O.timestamp).forEach(f=>{let O=M.createEl("div",{cls:"noteMover-history-entry noteMover-bulk-file-entry"}),H=O.createEl("div",{cls:"noteMover-history-entry-content"}),pe=new Date(f.timestamp).toLocaleString("en-US");if(H.createEl("div",{cls:"noteMover-history-entry-info",text:`\u{1F4C4} ${f.fileName} - ${pe}`}),H.createEl("div",{cls:"noteMover-history-entry-paths",text:`${f.sourcePath} \u2192 ${f.destinationPath}`}),m.isMobile()){let L=O.createDiv({cls:"noteMover-history-entry-buttons-mobile"}),J=L.createEl("button",{cls:"noteMover-history-entry-button-mobile",text:"Open"});J.onclick=()=>{let we=this.app.vault.getAbstractFileByPath(f.destinationPath);if(we&&we instanceof w.TFile)this.app.workspace.getLeaf().openFile(we),this.close();else{let Qe=this.app.vault.getAbstractFileByPath(f.sourcePath);Qe&&Qe instanceof w.TFile?(this.app.workspace.getLeaf().openFile(Qe),this.close()):g.error(`Could not find file ${f.fileName}`,{duration:b.DURATION_OVERRIDE})}};let de=L.createEl("button",{cls:"noteMover-history-entry-button-mobile",text:"Undo"});de.onclick=async()=>{await this.historyManager.undoEntry(f.id)?this.onOpen():g.error(`Could not undo move for ${f.fileName}. File may have been moved or deleted.`,{duration:b.DURATION_OVERRIDE})};let Et=L.createEl("button",{cls:"noteMover-history-entry-button-mobile noteMover-history-entry-button-warning",text:"Add to Blacklist"});Et.onclick=async()=>{await this.plugin.noteMover.addFileToBlacklist(f.fileName)}}else new w.Setting(O).addButton(L=>{L.setIcon("file-text").setTooltip(`Open ${f.fileName}`).onClick(()=>{let J=this.app.vault.getAbstractFileByPath(f.destinationPath);if(J&&J instanceof w.TFile)this.app.workspace.getLeaf().openFile(J),this.close();else{let de=this.app.vault.getAbstractFileByPath(f.sourcePath);de&&de instanceof w.TFile?(this.app.workspace.getLeaf().openFile(de),this.close()):g.error(`Could not find file ${f.fileName}`,{duration:b.DURATION_OVERRIDE})}})}).addButton(L=>{L.setIcon("undo").setTooltip(`Undo move for ${f.fileName}`).onClick(async()=>{await this.historyManager.undoEntry(f.id)?this.onOpen():g.error(`Could not undo move for ${f.fileName}. File may have been moved or deleted.`,{duration:b.DURATION_OVERRIDE})})}).addButton(L=>{L.setIcon("ban").setTooltip(`Add ${f.fileName} to blacklist`).onClick(async()=>{await this.plugin.noteMover.addFileToBlacklist(f.fileName)})})});let S=new w.Setting(n).addButton(f=>{f.setButtonText(d.UI_TEXTS.UNDO_ALL).setIcon("undo").setTooltip(`Undo entire ${c.toLowerCase()}`).onClick(async()=>{await this.historyManager.undoBulkOperation(i.id)?this.onOpen():g.warning("Some files could not be moved back. Check console for details.",{duration:b.DURATION_OVERRIDE})})});if(m.isMobile()){let f=S.settingEl.querySelector("button");f&&(f.style.width="100%",f.style.minHeight="48px")}}createSingleEntry(t,i){let r=m.isMobile(),n=t.createEl("div",{cls:r?"noteMover-history-entry noteMover-single-operation noteMover-history-entry-mobile":"noteMover-history-entry noteMover-single-operation"}),s=n.createEl("div",{cls:"noteMover-history-entry-content"}),a=new Date(i.timestamp).toLocaleString("en-US");if(s.createEl("div",{cls:"noteMover-history-entry-info",text:`\u{1F4C4} ${i.fileName} - ${a}`}),s.createEl("div",{cls:"noteMover-history-entry-paths",text:`${i.sourcePath} \u2192 ${i.destinationPath}`}),r){let c=n.createDiv({cls:"noteMover-history-entry-buttons-mobile"}),u=c.createEl("button",{cls:"noteMover-history-entry-button-mobile",text:"Open"});u.onclick=()=>{let M=this.app.vault.getAbstractFileByPath(i.destinationPath);if(M&&M instanceof w.TFile)this.app.workspace.getLeaf().openFile(M),this.close();else{let E=this.app.vault.getAbstractFileByPath(i.sourcePath);E&&E instanceof w.TFile?(this.app.workspace.getLeaf().openFile(E),this.close()):g.error(`Could not find file ${i.fileName}`,{duration:b.DURATION_OVERRIDE})}};let p=c.createEl("button",{cls:"noteMover-history-entry-button-mobile",text:"Undo"});p.onclick=async()=>{await this.historyManager.undoEntry(i.id)&&this.onOpen()};let y=c.createEl("button",{cls:"noteMover-history-entry-button-mobile noteMover-history-entry-button-warning",text:"Add to Blacklist"});y.onclick=async()=>{await this.plugin.noteMover.addFileToBlacklist(i.fileName)}}else new w.Setting(n).addButton(c=>{c.setIcon("file-text").setTooltip(`Open ${i.fileName}`).onClick(()=>{let u=this.app.vault.getAbstractFileByPath(i.destinationPath);if(u&&u instanceof w.TFile)this.app.workspace.getLeaf().openFile(u),this.close();else{let p=this.app.vault.getAbstractFileByPath(i.sourcePath);p&&p instanceof w.TFile?(this.app.workspace.getLeaf().openFile(p),this.close()):g.error(`Could not find file ${i.fileName}`,{duration:b.DURATION_OVERRIDE})}})}).addButton(c=>{c.setIcon("undo").setTooltip("Undo").onClick(async()=>{await this.historyManager.undoEntry(i.id)&&this.onOpen()})}).addButton(c=>{c.setIcon("ban").setTooltip(`Add ${i.fileName} to blacklist`).onClick(async()=>{await this.plugin.noteMover.addFileToBlacklist(i.fileName)})})}onClose(){super.onClose()}};var ge=require("obsidian");var he=class extends x{constructor(t,i,r,n={}){super(t,{title:"Move Preview",titleIcon:"\u{1F50D}",cssClass:"note-mover-preview-modal",size:"large",...n});this.plugin=i;this.movePreview=r}createContent(){let{contentEl:t}=this,i=this.movePreview,r=`${i.totalFiles} files analyzed \u2022 ${i.successfulMoves.length} will be moved`;t.createEl("p",{text:r,cls:"noteMover-modal-subtitle"}),i.successfulMoves.length>0&&this.createSuccessfulMovesSection(t,i.successfulMoves),i.totalFiles===0&&t.createEl("div",{cls:"noteMover-modal-empty",text:"No files found to analyze."}),this.createActionButtons(t)}createSuccessfulMovesSection(t,i){let r=m.isMobile(),n=this.createSection(t,r?"noteMover-preview-section noteMover-preview-section-success noteMover-preview-section-mobile":"noteMover-preview-section noteMover-preview-section-success"),s=n.createEl("div",{cls:"noteMover-modal-section-header"});s.innerHTML=`<h3>\u2705 Files to be moved (${i.length})</h3>`;let o=n.createEl("div",{cls:r?"noteMover-modal-list noteMover-modal-list-mobile":"noteMover-modal-list"});i.forEach(a=>{let c=o.createEl("div",{cls:r?"noteMover-modal-list-item noteMover-preview-item-success noteMover-preview-item-mobile":"noteMover-modal-list-item noteMover-preview-item-success"}),u=c.createEl("div",{cls:"noteMover-preview-item-main"}),p=u.createEl("div",{cls:"noteMover-preview-item-filename"});p.textContent=a.fileName;let y=u.createEl("div",{cls:r?"noteMover-preview-item-paths noteMover-preview-item-paths-mobile":"noteMover-preview-item-paths"});if(r){let E=y.createEl("div",{cls:"noteMover-preview-path-mobile noteMover-preview-path-current"});E.textContent=a.currentPath;let S=y.createEl("div",{cls:"noteMover-preview-arrow-mobile"});S.textContent="\u2193";let f=y.createEl("div",{cls:"noteMover-preview-path-mobile noteMover-preview-path-target"});f.textContent=a.targetPath}else y.innerHTML=`
          <span class="noteMover-current-path">${a.currentPath}</span>
          <span class="noteMover-arrow">\u2192</span>
          <span class="noteMover-target-path">${a.targetPath}</span>
        `;let M=c.createEl("div",{cls:r?"noteMover-preview-item-details noteMover-preview-item-details-mobile":"noteMover-preview-item-details"});if(a.matchedRule){let E=M.createEl("div",{cls:"noteMover-preview-item-rule"});E.innerHTML=`<span class="noteMover-rule-label">Rule:</span> <code>${a.matchedRule}</code>`}if(a.tags&&a.tags.length>0){let E=M.createEl("div",{cls:"noteMover-preview-item-tags"});E.innerHTML=`<span class="noteMover-tags-label">Tags:</span> ${a.tags.map(S=>`<span class="noteMover-tag">${S}</span>`).join(" ")}`}})}createActionButtons(t){let i=m.isMobile(),r=t.createEl("div",{cls:i?"noteMover-modal-footer noteMover-modal-footer-mobile":"noteMover-modal-footer"}),n=this.createButtonContainer(r);if(i){if(this.movePreview.successfulMoves.length>0){let c=new ge.Setting(n).addButton(u=>{u.setButtonText(`Move ${this.movePreview.successfulMoves.length} files`).setCta().onClick(()=>{this.executeMoves()})}).settingEl.querySelector("button");c&&(c.style.width="100%",c.style.minHeight="48px")}let o=new ge.Setting(n).addButton(a=>{a.setButtonText("Cancel").onClick(()=>{this.close()})}).settingEl.querySelector("button");o&&(o.style.width="100%",o.style.minHeight="48px")}else this.createButton(n,"Cancel",()=>{this.close()}),this.movePreview.successfulMoves.length>0&&this.createButton(n,`Move ${this.movePreview.successfulMoves.length} files`,()=>{this.executeMoves()},{isPrimary:!0})}async executeMoves(){this.close();let t=this.movePreview.successfulMoves,i=0,r=0;for(let n of t)try{let s=this.app.vault.getAbstractFileByPath(n.currentPath);s&&s instanceof ge.TFile&&(await this.plugin.noteMover.moveFileBasedOnTags(s,n.targetPath||"/",!0),i++)}catch(s){g.error(`Error moving file ${n.fileName}: ${s instanceof Error?s.message:String(s)}`),r++}r===0?g.success(`Successfully moved ${i} files!`):g.warning(`Moved ${i} files with ${r} errors. Check console for details.`)}};var Pe=class{constructor(e){this.plugin=e}setup(){this.plugin.addCommand({id:"trigger-note-movement",name:"Move active note to note folder",editorCallback:(e,t)=>{this.plugin.noteMover.moveFocusedNoteToDestination()}}),this.plugin.addCommand({id:"trigger-note-bulk-move",name:"Move all files in vault",callback:()=>{this.plugin.noteMover.moveAllFilesInVault()}}),this.plugin.addCommand({id:"show-history",name:"Show history",callback:()=>{new De(this.plugin.app,this.plugin.historyManager,this.plugin).open()}}),this.plugin.addCommand({id:"show-update-modal",name:"Show update modal",callback:()=>{this.plugin.updateManager.showUpdateModal(!0)}}),this.plugin.addCommand({id:"preview-bulk-movement",name:"Preview bulk movement for all files",callback:async()=>{try{let e=await this.plugin.noteMover.generateVaultMovePreview();new he(this.plugin.app,this.plugin,e).open()}catch(e){h(e,"Error generating preview",!1),g.error(`Error generating preview: ${e instanceof Error?e.message:String(e)}`)}}}),this.plugin.addCommand({id:"preview-note-movement",name:"Preview active note movement",editorCallback:async(e,t)=>{try{let i=await this.plugin.noteMover.generateActiveNotePreview();i?new he(this.plugin.app,this.plugin,i).open():g.warning("No active note to preview.")}catch(i){h(i,"Error generating preview",!1),g.error(`Error generating preview: ${i instanceof Error?i.message:String(i)}`)}}}),this.plugin.addCommand({id:"add-current-file-to-blacklist",name:"Add current file to blacklist",editorCallback:async(e,t)=>{var i;try{let r=(i=t.file)==null?void 0:i.name;if(!r){g.warning("No active file to add to blacklist.");return}await this.plugin.noteMover.addFileToBlacklist(r)}catch(r){h(r,"Error adding file to blacklist",!1),g.error(`Error adding file to blacklist: ${r instanceof Error?r.message:String(r)}`)}}})}};var mt=require("obsidian");var me=require("obsidian");var re=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i}addTriggerSettings(){let e=m.isMobile();new me.Setting(this.containerEl).setName("Triggers").setHeading();let t=new me.Setting(this.containerEl).setName("Enable on-edit trigger").setDesc("Automatically check and move the edited note when a file is modified").addToggle(r=>r.setValue(this.plugin.settings.settings.triggers.enableOnEditTrigger===!0).onChange(async n=>{var s;this.plugin.settings.settings.triggers.enableOnEditTrigger=n,await this.plugin.save_settings(),(s=this.plugin.triggerHandler)==null||s.toggleOnEditListener(),this.refreshDisplay()}));if(e){t.settingEl.addClass("noteMover-mobile-optimized");let r=t.settingEl.querySelector(".setting-item-control");r&&r.addClass("noteMover-mobile-toggle-control")}let i=new me.Setting(this.containerEl).setName("Enable periodic movement").setDesc("Enable the periodic movement of notes").addToggle(r=>r.setValue(this.plugin.settings.settings.triggers.enablePeriodicMovement).onChange(async n=>{var s;this.plugin.settings.settings.triggers.enablePeriodicMovement=n,await this.plugin.save_settings(),(s=this.plugin.triggerHandler)==null||s.togglePeriodic(),this.refreshDisplay()}));if(e){i.settingEl.addClass("noteMover-mobile-optimized");let r=i.settingEl.querySelector(".setting-item-control");r&&r.addClass("noteMover-mobile-toggle-control")}if(this.plugin.settings.settings.triggers.enablePeriodicMovement){let r=new me.Setting(this.containerEl).setName("Periodic movement interval").setDesc("Set the interval for the periodic movement of notes in minutes").addText(n=>n.setPlaceholder(d.PLACEHOLDER_TEXTS.INTERVAL).setValue(this.plugin.settings.settings.triggers.periodicMovementInterval.toString()).onChange(async s=>{var a;let o=parseInt(s);if(isNaN(o)){h(v("Interval must be a number"),"Periodic movement interval setting",!1);return}if(o<1){h(v("Interval must be greater than 0"),"Periodic movement interval setting",!1);return}this.plugin.settings.settings.triggers.periodicMovementInterval=o,await this.plugin.save_settings(),(a=this.plugin.triggerHandler)==null||a.togglePeriodic()}));if(e){r.settingEl.addClass("noteMover-mobile-optimized");let n=r.settingEl.querySelector(".setting-item-control");n&&n.addClass("noteMover-mobile-input-control");let s=r.settingEl.querySelector('input[type="text"]');s&&s.addClass("noteMover-mobile-text-input")}}}get app(){return this.plugin.app}};var fe=require("obsidian");var C=class{constructor(e,t){this.draggedElement=null;this.draggedIndex=-1;this.draggedData=null;this.container=e,this.options=t,this.setupEventListeners()}setupEventListeners(){this.container.addEventListener("dragstart",this.handleDragStart.bind(this)),this.container.addEventListener("dragover",this.handleDragOver.bind(this)),this.container.addEventListener("drop",this.handleDrop.bind(this)),this.container.addEventListener("dragend",this.handleDragEnd.bind(this)),this.container.addEventListener("dragenter",this.handleDragEnter.bind(this)),this.container.addEventListener("dragleave",this.handleDragLeave.bind(this))}handleDragStart(e){let t=e.target;if(!t.closest(this.options.handleSelector||".noteMover-drag-handle"))return;let r=t.closest(this.options.itemSelector||".setting-item");r&&(this.draggedElement=r,this.draggedIndex=this.getItemIndex(r),this.draggedData=this.getItemData(r),e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",this.draggedIndex.toString())),r.classList.add("noteMover-dragging"))}handleDragOver(e){if(!this.draggedElement)return;e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="move");let i=e.target.closest(this.options.itemSelector||".setting-item");if(!i||i===this.draggedElement)return;this.clearDragOverClasses();let r=i.getBoundingClientRect(),n=r.top+r.height/2,s=e.clientY<n,o=this.getItemIndex(i),a=this.getItemIndex(this.draggedElement),c=s?o:o+1;c===a||c===a+1||(s?i.classList.add("noteMover-drag-over-top"):i.classList.add("noteMover-drag-over-bottom"))}handleDragEnter(e){if(!this.draggedElement)return;let i=e.target.closest(this.options.itemSelector||".setting-item");if(i&&i!==this.draggedElement){let r=this.getItemIndex(i),n=this.getItemIndex(this.draggedElement);r!==n&&r!==n+1&&i.classList.add("noteMover-drag-over")}}handleDragLeave(e){let i=e.target.closest(this.options.itemSelector||".setting-item");if(i&&i!==this.draggedElement){let r=i.getBoundingClientRect(),n=e.clientX,s=e.clientY;(n<r.left||n>r.right||s<r.top||s>r.bottom)&&i.classList.remove("noteMover-drag-over","noteMover-drag-over-top","noteMover-drag-over-bottom")}}handleDrop(e){if(!this.draggedElement)return;e.preventDefault();let i=e.target.closest(this.options.itemSelector||".setting-item");if(!i||i===this.draggedElement)return;let r=this.getItemIndex(i),n=i.getBoundingClientRect(),s=n.top+n.height/2,a=e.clientY<s?r:r+1;this.draggedIndex!==a&&a!==this.draggedIndex+1&&(this.options.onReorder(this.draggedIndex,a),this.options.onSave&&this.options.onSave()),this.clearDragOverClasses()}handleDragEnd(e){this.draggedElement&&this.draggedElement.classList.remove("noteMover-dragging"),this.clearDragOverClasses(),this.draggedElement=null,this.draggedIndex=-1,this.draggedData=null}getItemIndex(e){return Array.from(this.container.querySelectorAll(this.options.itemSelector||".setting-item")).indexOf(e)}getItemData(e){return{element:e,index:this.getItemIndex(e)}}clearDragOverClasses(){this.container.querySelectorAll(".noteMover-drag-over, .noteMover-drag-over-top, .noteMover-drag-over-bottom").forEach(t=>{t.classList.remove("noteMover-drag-over","noteMover-drag-over-top","noteMover-drag-over-bottom")})}static createDragHandle(){let e=document.createElement("div");return e.className="noteMover-drag-handle",e.innerHTML="\u22EE\u22EE",e.setAttribute("draggable","true"),e.setAttribute("aria-label","Drag to reorder"),e.setAttribute("role","button"),e.setAttribute("tabindex","0"),e.setAttribute("title","Drag to reorder"),e}static wrapWithDragHandle(e){let t=document.createElement("div");t.className="setting-item noteMover-with-drag-handle";let i=document.createElement("div");return i.className="noteMover-drag-handle-container",i.appendChild(this.createDragHandle()),t.appendChild(i),t.appendChild(e),t}destroy(){this.container.removeEventListener("dragstart",this.handleDragStart.bind(this)),this.container.removeEventListener("dragover",this.handleDragOver.bind(this)),this.container.removeEventListener("drop",this.handleDrop.bind(this)),this.container.removeEventListener("dragend",this.handleDragEnd.bind(this)),this.container.removeEventListener("dragenter",this.handleDragEnter.bind(this)),this.container.removeEventListener("dragleave",this.handleDragLeave.bind(this))}};var Le=require("obsidian");var Ne=[{label:"tag: ",value:"tag"},{label:"content: ",value:"content"},{label:"fileName: ",value:"fileName"},{label:"created_at: ",value:"created_at"},{label:"path: ",value:"path"},{label:"updated_at: ",value:"updated_at"},{label:"property: ",value:"property"}],N=class extends Le.AbstractInputSuggest{constructor(t,i){super(t,i);this.app=t;this.inputEl=i;this.selectedType=null;this.tags=new Set;this.folders=[];this.fileNames=[];this.propertyKeys=new Set;this.propertyValues=new Map;this.metadataExtractor=new T(t),this.loadTags(),this.loadFolders(),this.loadFileNames(),this.loadPropertyKeysAndValues(),this.refreshDataHandler=()=>this.refreshData(),this.app.metadataCache.on("changed",this.refreshDataHandler)}loadTags(){this.tags=this.metadataExtractor.extractAllTags()}loadFolders(){let t=this.app.vault.getAllLoadedFiles();this.folders=t.filter(i=>i instanceof Le.TFolder)}loadFileNames(){let t=this.app.vault.getMarkdownFiles();this.fileNames=t.map(i=>i.name)}refreshData(){this.loadTags(),this.loadFolders(),this.loadFileNames(),this.loadPropertyKeysAndValues()}loadPropertyKeysAndValues(){this.app.vault.getMarkdownFiles().forEach(i=>{let r=this.app.metadataCache.getFileCache(i);r!=null&&r.frontmatter&&Object.entries(r.frontmatter).forEach(([n,s])=>{if(!n.startsWith("position")&&n!=="tags"&&(this.propertyKeys.add(n),this.propertyValues.has(n)||this.propertyValues.set(n,new Set),s!=null))if(this.metadataExtractor.isListProperty(s))this.metadataExtractor.parseListProperty(s).forEach(a=>{this.propertyValues.get(n).add(a)});else{let o=String(s);this.propertyValues.get(n).add(o)}})})}getSuggestions(t){let i=Ne.find(r=>t.toLowerCase().startsWith(r.label.toLowerCase()));if(!i||t.trim()==="")return this.selectedType=null,Ne.filter(r=>t.trim()===""||r.label.toLowerCase().includes(t.toLowerCase())).map(r=>r.label);{if(this.selectedType=i.value,this.selectedType==="property")return this.getPropertySuggestions(t,i.label);let r=t.replace(/^[^:]+:\s*/i,"").toLowerCase();switch(this.selectedType){case"tag":return Array.from(this.tags).filter(n=>n.toLowerCase().includes(r)).map(n=>`${i.label}${n}`);case"fileName":return this.fileNames.filter(n=>n.toLowerCase().includes(r)).map(n=>`${i.label}${n}`);case"path":return this.folders.map(n=>n.path).filter(n=>n.toLowerCase().includes(r)).map(n=>`${i.label}${n}`);case"content":return[];case"created_at":case"updated_at":return[];default:return[]}}}getPropertySuggestions(t,i){let r=t.substring(i.length),n=r.indexOf(":");if(n===-1){let s=r.toLowerCase();return Array.from(this.propertyKeys).filter(o=>o.toLowerCase().includes(s)).map(o=>`${i}${o}`)}else{let s=r.substring(0,n),o=r.substring(n+1).trim().toLowerCase(),a=this.propertyValues.get(s);return a?Array.from(a).sort((u,p)=>u.localeCompare(p)).filter(u=>u.toLowerCase().includes(o)).map(u=>`${i}${s}: ${u}`):[]}}renderSuggestion(t,i){i.setText(t)}destroy(){this.app.metadataCache.off("changed",this.refreshDataHandler)}selectSuggestion(t){let i=Ne.find(n=>t===n.label);if(i){this.selectedType=i.value,this.inputEl.value=t,this.inputEl.trigger("input");return}if(this.selectedType==="property"&&t.startsWith("property: "))if((t.substring(10).match(/:/g)||[]).length===0){this.inputEl.value=t+":",this.inputEl.trigger("input");return}else{this.inputEl.value=t,this.inputEl.trigger("input"),this.close();return}let r=this.selectedType?Ne.find(n=>n.value===this.selectedType):null;r&&!t.startsWith(r.label)?this.inputEl.value=`${r.label}${t}`:this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};var ne=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i;this.dragDropManager=null;this.advancedSuggestInstances=[]}addFilterSettings(){new fe.Setting(this.containerEl).setName("Filter").setHeading(),new fe.Setting(this.containerEl).setName("Filter Description").setDesc("These are blacklist filters. Files that match any of the specified criteria will be excluded from movement operations."),this.addPeriodicMovementFilterArray();let e=m.isMobile(),t=new fe.Setting(this.containerEl).addButton(i=>i.setButtonText("Add new filter").setCta().onClick(async()=>{this.plugin.settings.settings.filters.filter.push({value:""}),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()}));if(e){t.settingEl.addClass("noteMover-mobile-optimized");let i=t.settingEl.querySelector(".setting-item-control");i&&i.addClass("noteMover-mobile-button-control")}}addPeriodicMovementFilterArray(){this.cleanupAdvancedSuggestInstances();let e=m.isMobile(),t=document.createElement("div");t.className="noteMover-filters-container",e&&t.addClass("noteMover-mobile-filters-container"),this.containerEl.appendChild(t),this.setupDragDropManager(t),this.plugin.settings.settings.filters.filter.forEach((i,r)=>{let n=new fe.Setting(t).addSearch(s=>{let o=new N(this.app,s.inputEl);this.advancedSuggestInstances.push(o),s.setPlaceholder(d.PLACEHOLDER_TEXTS.FILTER).setValue((i==null?void 0:i.value)||"").onChange(async a=>{!a||a.trim()===""?this.plugin.settings.settings.filters.filter[r]={value:""}:this.plugin.settings.settings.filters.filter[r]={value:a},await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager()}),s.containerEl.addClass("noteMover-search")}).addExtraButton(s=>s.setIcon("cross").onClick(async()=>{this.plugin.settings.settings.filters.filter.splice(r,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()}));if(this.addDragHandle(n.settingEl,r),n.infoEl.remove(),e){n.settingEl.addClass("noteMover-mobile-filter-item");let s=n.settingEl.querySelector(".setting-item-control");s&&s.addClass("noteMover-mobile-filter-controls");let o=n.settingEl.querySelector('input[type="search"]');o&&o.addClass("noteMover-mobile-filter-input")}})}moveFilter(e,t){let i=this.plugin.settings.settings.filters.filter,r=Math.max(0,Math.min(i.length-1,e+t));[i[e],i[r]]=[i[r],i[e]],this.plugin.save_settings(),this.refreshDisplay()}setupDragDropManager(e){this.dragDropManager&&this.dragDropManager.destroy(),this.dragDropManager=new C(e,{onReorder:(t,i)=>{this.reorderFilters(t,i)},onSave:async()=>{await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()},itemSelector:".setting-item",handleSelector:".noteMover-drag-handle"})}addDragHandle(e,t){let i=C.createDragHandle(),r=document.createElement("div");r.className="noteMover-drag-handle-container",r.appendChild(i),e.insertBefore(r,e.firstChild),e.classList.add("noteMover-with-drag-handle")}reorderFilters(e,t){if(e===t)return;let i=this.plugin.settings.settings.filters.filter,[r]=i.splice(e,1);i.splice(t,0,r)}get app(){return this.plugin.app}cleanupAdvancedSuggestInstances(){this.advancedSuggestInstances.forEach(e=>{e.destroy()}),this.advancedSuggestInstances=[]}cleanup(){this.cleanupAdvancedSuggestInstances(),this.dragDropManager&&(this.dragDropManager.destroy(),this.dragDropManager=null)}};var $=require("obsidian");var Ae=require("obsidian");var I=class extends Ae.AbstractInputSuggest{constructor(t,i){super(t,i);this.inputEl=i}getSuggestions(t){let i=this.app.vault.getAllLoadedFiles(),r=[],n=t.toLowerCase();return i.forEach(s=>{s instanceof Ae.TFolder&&s.path.toLowerCase().contains(n)&&r.push(s)}),r.slice(0,nt.SUGGESTION_LIMITS.FOLDER_SUGGESTIONS)}renderSuggestion(t,i){i.setText(t.path)}selectSuggestion(t){this.setValue(t.path),this.inputEl.trigger("input"),this.close()}};var k=require("obsidian");var at=require("obsidian");var X=class extends at.AbstractInputSuggest{constructor(t,i){super(t,i);this.inputEl=i;this.tags=new Set,this.metadataExtractor=new T(t),this.loadTags()}loadTags(){this.tags=this.metadataExtractor.extractAllTags()}getSuggestions(t){let i=t.toLowerCase();return Array.from(this.tags).filter(r=>r.toLowerCase().includes(i))}renderSuggestion(t,i){i.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}};var dt=require("obsidian");var lt=["is","is not","contains","starts with","ends with","match regex","does not contain","does not starts with","does not ends with","does not match regex"],ct=["includes item","does not include item","all are","all start with","all end with","all match regex","any contain","any end with","any match regex","none contain","none start with","none end with","count is","count is not","count is less than","count is more than"],ut=["is","is before","is after","time is before","time is after","time is before now","time is after now","date is","date is not","date is before","date is after","date is today","date is not today","is under X days ago","is over X days ago","day of week is","day of week is not","day of week is before","day of week is after","day of month is","day of month is not","day of month is before","day of month is after","month is","month is not","month is before","month is after","year is","year is not","year is before","year is after"],Y=["has any value","has no value","property is present","property is missing"],It=[...Y,"equals","does not equal","is less than","is more than","is divisible by","is not divisible by"],Ot=[...Y,"is true","is false"];function j(l){switch(l){case"fileName":case"folder":case"extension":case"headings":return lt;case"tag":case"links":case"embeds":return ct;case"created_at":case"modified_at":return ut;case"properties":return Y;default:return[]}}function _(l){switch(l){case"text":return[...Y,...lt];case"number":return It;case"checkbox":return Ot;case"date":return[...Y,...ut];case"list":return[...Y,...ct];default:return Y}}function pt(l,e){return j(e).includes(l)}function tt(l,e){return _(e).includes(l)}function se(l){switch(l){case"fileName":case"folder":case"extension":case"headings":return"contains";case"tag":case"links":case"embeds":return"includes item";case"created_at":case"modified_at":return"is";case"properties":return"has any value";default:return"contains"}}function Fe(l){return["match regex","does not match regex","all match regex","any match regex"].includes(l)}function A(l){return!["has any value","has no value","property is present","property is missing","is true","is false"].includes(l)}function ve(l,e){var r;let t=l.vault.getMarkdownFiles(),i=[];for(let n of t){let s=l.metadataCache.getFileCache(n);((r=s==null?void 0:s.frontmatter)==null?void 0:r[e])!==void 0&&i.push(s.frontmatter[e])}return i.length===0?null:it(i)}function it(l){let e={text:0,number:0,checkbox:0,date:0,list:0};for(let r of l){let n=xt(r);e[n]++}let t=0,i="text";for(let[r,n]of Object.entries(e))n>t&&(t=n,i=r);return t===0?"text":t>l.length/2?i:e.list>0?"list":e.date>0?"date":e.number>0?"number":e.checkbox>0?"checkbox":"text"}function xt(l){if(l==null)return"text";if(typeof l=="boolean")return"checkbox";if(typeof l=="number")return"number";if(Array.isArray(l))return"list";if(typeof l=="string"){if(Pt(l))return"date";if(Rt(l))return"number";if(Dt(l))return"checkbox";if(Nt(l))return"list"}return"text"}function Rt(l){let e=l.trim();if(/^-?\d+(\.\d+)?$/.test(e)){let t=parseFloat(e);return!isNaN(t)&&isFinite(t)}return!1}function Dt(l){let e=l.trim().toLowerCase();return e==="true"||e==="false"||e==="yes"||e==="no"||e==="on"||e==="off"||e==="1"||e==="0"}function Pt(l){let e=l.trim();if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let t=new Date(e);return!isNaN(t.getTime())&&t.toISOString().startsWith(e)}if(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/.test(e)){let t=new Date(e);return!isNaN(t.getTime())}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)||/^\d{1,2}\.\d{1,2}\.\d{4}$/.test(e)||/^\d{4}\/\d{1,2}\/\d{1,2}$/.test(e)||/^\d{1,2}\/\d{1,2}\/\d{2}$/.test(e)||/^\d{1,2}\.\d{1,2}\.\d{2}$/.test(e)){let t=new Date(e),i=new Date(e.replace(/(\d{1,2})\/(\d{1,2})\/(\d{4})/,"$3-$2-$1")),r=new Date(e.replace(/(\d{1,2})\.(\d{1,2})\.(\d{4})/,"$3-$2-$1"));return!isNaN(t.getTime())||!isNaN(i.getTime())||!isNaN(r.getTime())}return!1}function Nt(l){if(Array.isArray(l))return!0;if(typeof l=="string"){let e=l.trim();if(e.includes(",")&&e.split(",").map(i=>i.trim()).filter(i=>i.length>0).length>1||e.startsWith("[")&&e.endsWith("]")||e.includes(`
-`)||e.startsWith("-"))return!0}return!1}var G=class extends dt.AbstractInputSuggest{constructor(t,i){super(t,i);this.inputEl=i;this.properties=new Map,this.metadataExtractor=new T(t),this.loadProperties(),this.refreshDataHandler=()=>this.refreshData(),this.app.metadataCache.on("changed",this.refreshDataHandler)}loadProperties(){this.properties.clear();let t=this.app.vault.getMarkdownFiles(),i=new Map;t.forEach(r=>{let n=this.app.metadataCache.getFileCache(r);n!=null&&n.frontmatter&&Object.entries(n.frontmatter).forEach(([s,o])=>{!s.startsWith("position")&&s!=="tags"&&(i.has(s)||i.set(s,[]),i.get(s).push(o))})}),i.forEach((r,n)=>{let s=it(r);this.properties.set(n,{name:n,type:s,exampleValue:this.getExampleValue(r[0])})})}isMoreSpecificType(t,i){let r=["text","list","date","number","checkbox"];return r.indexOf(i)>r.indexOf(t)}getExampleValue(t){if(t==null)return"";if(Array.isArray(t))return t.slice(0,2).join(", ")+(t.length>2?"...":"");let i=String(t);return i.length>20?i.substring(0,20)+"...":i}refreshData(){this.loadProperties()}getSuggestions(t){let i=t.toLowerCase(),r=[];return this.properties.forEach((n,s)=>{s.toLowerCase().includes(i)&&r.push(s)}),r.sort((n,s)=>n.localeCompare(s))}renderSuggestion(t,i){let r=this.properties.get(t);if(r){let n=i.createDiv({cls:"noteMover-property-suggestion"});n.createDiv({cls:"noteMover-property-name"}).setText(r.name),n.createDiv({cls:"noteMover-property-meta"}).setText(`${r.type}${r.exampleValue?` \u2022 ${r.exampleValue}`:""}`)}else i.setText(t)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}getPropertyType(t){let i=this.properties.get(t);return i?i.type:null}getAllProperties(){return Array.from(this.properties.keys()).sort()}destroy(){this.app.metadataCache.off("changed",this.refreshDataHandler)}};var gt=require("obsidian"),q=class extends gt.AbstractInputSuggest{constructor(t,i,r,n){super(t,i);this.inputEl=i;this.propertyName=r,this.propertyType=n,this.loadAvailableValues()}loadAvailableValues(){var i;if(this.availableValues=new Set,this.propertyType==="date")return;let t=this.app.vault.getMarkdownFiles();for(let r of t){let n=this.app.metadataCache.getFileCache(r);if(((i=n==null?void 0:n.frontmatter)==null?void 0:i[this.propertyName])!==void 0){let s=n.frontmatter[this.propertyName];this.addValueToSuggestions(s)}}}addValueToSuggestions(t){switch(this.propertyType){case"text":typeof t=="string"&&t.trim()&&this.availableValues.add(t.trim());break;case"number":typeof t=="number"?this.availableValues.add(t.toString()):typeof t=="string"&&this.isNumberString(t)&&this.availableValues.add(t.trim());break;case"checkbox":typeof t=="boolean"?this.availableValues.add(t.toString()):typeof t=="string"&&this.isBooleanString(t)&&this.availableValues.add(t.trim().toLowerCase());break;case"list":Array.isArray(t)?t.forEach(i=>{typeof i=="string"&&i.trim()&&this.availableValues.add(i.trim())}):typeof t=="string"&&this.isListProperty(t)&&t.split(",").map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>this.availableValues.add(r));break;case"date":break}}isNumberString(t){let i=t.trim();if(/^-?\d+(\.\d+)?$/.test(i)){let r=parseFloat(i);return!isNaN(r)&&isFinite(r)}return!1}isBooleanString(t){let i=t.trim().toLowerCase();return i==="true"||i==="false"||i==="yes"||i==="no"||i==="on"||i==="off"||i==="1"||i==="0"}isListProperty(t){if(Array.isArray(t))return!0;if(typeof t=="string"){let i=t.trim();if(i.includes(",")&&i.split(",").map(n=>n.trim()).filter(n=>n.length>0).length>1||i.startsWith("[")&&i.endsWith("]")||i.includes(`
-`)||i.startsWith("-"))return!0}return!1}getSuggestions(t){if(this.propertyType==="date")return[];let i=t.toLowerCase(),r=[];return this.availableValues.forEach(n=>{n.toLowerCase().includes(i)&&r.push(n)}),r.sort((n,s)=>n.localeCompare(s))}renderSuggestion(t,i){let r=i.createDiv({cls:"noteMover-property-value-suggestion"});r.createDiv({cls:"noteMover-property-value-text"}).setText(t),r.createDiv({cls:"noteMover-property-value-type"}).setText(`(${this.propertyType})`)}selectSuggestion(t){this.inputEl.value=t,this.inputEl.trigger("input"),this.close()}updateProperty(t,i){this.propertyName=t,this.propertyType=i,this.loadAvailableValues()}refreshSuggestions(){this.loadAvailableValues()}};var F=class{constructor(e,t,i){this.descriptionEl=null;this.cardEl=e.createDiv({cls:"noteMover-mobile-modal-card"}),this.headerEl=this.cardEl.createDiv({cls:"noteMover-mobile-modal-card-header"}),this.titleEl=this.headerEl.createDiv({cls:"noteMover-mobile-modal-card-title"}),this.titleEl.textContent=t,i&&(this.descriptionEl=this.cardEl.createDiv({cls:"noteMover-mobile-modal-card-description"}),this.descriptionEl.textContent=i),this.contentEl=this.cardEl.createDiv({cls:"noteMover-mobile-modal-card-content"})}getCardElement(){return this.cardEl}getContentElement(){return this.contentEl}getHeaderElement(){return this.headerEl}setDescription(e){this.descriptionEl?this.descriptionEl.textContent=e:(this.descriptionEl=this.cardEl.createDiv({cls:"noteMover-mobile-modal-card-description"}),this.descriptionEl.textContent=e)}addClass(e){this.cardEl.addClass(e)}};var ye=class{constructor(e,t,i,r,n,s){this.modalCard=new F(e,t,i),this.modalCard.addClass("noteMover-mobile-modal-input");let o=this.modalCard.getContentElement();this.inputEl=o.createEl("input",{cls:"noteMover-mobile-text-input",type:"text",attr:{placeholder:r,value:n}}),this.inputEl.addEventListener("input",async()=>{await s(this.inputEl.value)})}setValue(e){this.inputEl.value=e}getValue(){return this.inputEl.value}getInputElement(){return this.inputEl}getCardElement(){return this.modalCard.getCardElement()}};var Ee=class{constructor(e,t,i,r,n){this.modalCard=new F(e,t,i),this.modalCard.addClass("noteMover-mobile-modal-toggle");let s=this.modalCard.getHeaderElement();this.toggleEl=s.createDiv({cls:"noteMover-mobile-toggle-switch"}),this.toggleInput=document.createElement("input"),this.toggleInput.type="checkbox",this.toggleInput.className="noteMover-mobile-toggle-input",this.toggleInput.checked=r,this.toggleEl.appendChild(this.toggleInput);let o=this.toggleEl.createDiv({cls:"noteMover-mobile-toggle-slider"});this.updateToggleState(r),this.toggleInput.addEventListener("change",async()=>{let c=this.toggleInput.checked;this.updateToggleState(c),await n(c)}),this.toggleEl.addEventListener("click",c=>{c.target!==this.toggleInput&&this.toggleInput.click()});let a=this.modalCard.getContentElement();a.style.display="none"}updateToggleState(e){e?this.toggleEl.addClass("is-active"):this.toggleEl.removeClass("is-active")}setValue(e){this.toggleInput.checked=e,this.updateToggleState(e)}getValue(){return this.toggleInput.checked}getCardElement(){return this.modalCard.getCardElement()}};var B=class{constructor(e,t,i,r,n,s={}){this.modalCard=new F(e,t,i),this.modalCard.addClass("noteMover-mobile-modal-button");let o=this.modalCard.getContentElement();this.buttonEl=o.createEl("button",{cls:"noteMover-mobile-action-btn",text:r}),s.isPrimary?(this.buttonEl.addClass("mod-cta"),this.buttonEl.style.background="var(--interactive-accent)",this.buttonEl.style.color="var(--text-on-accent)"):(s.isWarning||s.isDanger)&&this.buttonEl.addClass("noteMover-mobile-delete-btn"),this.buttonEl.addEventListener("click",async()=>{await n()})}setButtonText(e){this.buttonEl.textContent=e}getButtonElement(){return this.buttonEl}getCardElement(){return this.modalCard.getCardElement()}};var Me=class{constructor(e,t){this.titleEl=null;this.sectionEl=e.createDiv({cls:"noteMover-mobile-modal-section"}),t&&(this.titleEl=this.sectionEl.createEl("h3",{cls:"noteMover-mobile-modal-section-title",text:t}))}getSectionElement(){return this.sectionEl}addClass(e){this.sectionEl.addClass(e)}};var ht=require("obsidian");var be=class{constructor(e,t,i,r){this.propertyNameInput=null;this.valueInput=null;this.moveUpButton=null;this.moveDownButton=null;this.cardEl=e.createDiv({cls:"noteMover-mobile-trigger-card"}),this.headerEl=this.cardEl.createDiv({cls:"noteMover-mobile-trigger-card-header"});let n=this.headerEl.createDiv({cls:"noteMover-mobile-trigger-move-buttons"});if(i.canMoveUp!==!1){let u=m.createMoveButton(n,"up",async()=>{i.onMoveUp&&await i.onMoveUp()},!1);u&&(this.moveUpButton=u)}if(i.canMoveDown!==!1){let u=m.createMoveButton(n,"down",async()=>{i.onMoveDown&&await i.onMoveDown()},!1);u&&(this.moveDownButton=u)}let s=this.headerEl.createDiv({cls:"noteMover-mobile-trigger-delete-container"});this.deleteButton=s.createEl("button",{cls:"noteMover-mobile-trigger-delete-btn"}),(0,ht.setIcon)(this.deleteButton,"x"),this.deleteButton.addEventListener("click",async()=>{i.onDelete&&await i.onDelete()}),this.fieldsContainer=this.cardEl.createDiv({cls:"noteMover-mobile-trigger-fields"});let o=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:"Criteria Type"});this.criteriaTypeSelect=this.fieldsContainer.createEl("select",{cls:"noteMover-mobile-text-input"}),["tag","fileName","folder","created_at","modified_at","extension","links","embeds","properties","headings"].forEach(u=>{let p=this.criteriaTypeSelect.createEl("option",{value:u,text:u});t.criteriaType===u&&(p.selected=!0)}),this.criteriaTypeSelect.addEventListener("change",()=>{t.criteriaType=this.criteriaTypeSelect.value,t.operator=se(t.criteriaType),t.criteriaType!=="properties"&&(delete t.propertyName,delete t.propertyType),i.onCriteriaTypeChange&&i.onCriteriaTypeChange(t.criteriaType)});let c=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:"Operator"});if(this.operatorSelect=this.fieldsContainer.createEl("select",{cls:"noteMover-mobile-text-input"}),this.populateOperatorDropdown(t,r),this.operatorSelect.addEventListener("change",()=>{t.operator=this.operatorSelect.value,i.onOperatorChange&&i.onOperatorChange(t.operator)}),t.criteriaType==="properties"){let u=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:"Property Name"});this.propertyNameInput=this.fieldsContainer.createEl("input",{type:"text",cls:"noteMover-mobile-text-input",placeholder:"Property Name",value:t.propertyName||""}),new G(r,this.propertyNameInput),this.propertyNameInput.addEventListener("input",()=>{t.propertyName=this.propertyNameInput.value;let p=ve(r,t.propertyName);p?(t.propertyType=p,i.onRender&&i.onRender()):i.onPropertyNameChange&&i.onPropertyNameChange(t.propertyName||"")})}if(A(t.operator)){let u=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:t.criteriaType==="tag"?"Tag":"Value"});this.valueInput=this.fieldsContainer.createEl("input",{type:"text",cls:"noteMover-mobile-text-input",placeholder:t.criteriaType==="tag"?"#tag":"Value",value:t.value||""}),this.valueInput.addEventListener("input",()=>{t.value=this.valueInput.value,i.onValueChange&&i.onValueChange(t.value)}),t.criteriaType==="tag"?new X(r,this.valueInput):t.criteriaType==="folder"?new I(r,this.valueInput):t.criteriaType==="properties"&&t.propertyName&&t.propertyType&&new q(r,this.valueInput,t.propertyName,t.propertyType)}}populateOperatorDropdown(e,t){this.operatorSelect.empty();let i;e.criteriaType==="properties"&&e.propertyType?i=_(e.propertyType):i=j(e.criteriaType),i.forEach(r=>{let n=this.operatorSelect.createEl("option",{value:r,text:r});e.operator===r&&(n.selected=!0)})}updateOperatorDropdown(e,t){this.populateOperatorDropdown(e,t)}updateValueField(e,t,i){let r=A(e.operator),n=this.valueInput!==null;if(r&&!n){let s=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:e.criteriaType==="tag"?"Tag":"Value"});this.valueInput=this.fieldsContainer.createEl("input",{type:"text",cls:"noteMover-mobile-text-input",placeholder:e.criteriaType==="tag"?"#tag":"Value",value:e.value||""}),this.valueInput.addEventListener("input",()=>{e.value=this.valueInput.value,i.onValueChange&&i.onValueChange(e.value)}),e.criteriaType==="tag"?new X(t,this.valueInput):e.criteriaType==="folder"?new I(t,this.valueInput):e.criteriaType==="properties"&&e.propertyName&&e.propertyType&&new q(t,this.valueInput,e.propertyName,e.propertyType)}else if(!r&&n){let s=this.valueInput.previousElementSibling;s&&s.classList.contains("noteMover-mobile-trigger-field-label")&&s.remove(),this.valueInput.remove(),this.valueInput=null}else r&&n&&this.valueInput&&(this.valueInput.value=e.value||"")}updatePropertyField(e,t,i){let r=e.criteriaType==="properties",n=this.propertyNameInput!==null;if(r&&!n){let s=this.operatorSelect.previousElementSibling,o=this.fieldsContainer.createDiv({cls:"noteMover-mobile-trigger-field-label",text:"Property Name"});this.propertyNameInput=this.fieldsContainer.createEl("input",{type:"text",cls:"noteMover-mobile-text-input",placeholder:"Property Name",value:e.propertyName||""}),s&&(this.fieldsContainer.insertBefore(o,s),this.fieldsContainer.insertBefore(this.propertyNameInput,s)),new G(t,this.propertyNameInput),this.propertyNameInput.addEventListener("input",()=>{e.propertyName=this.propertyNameInput.value;let a=ve(t,e.propertyName);a&&(e.propertyType=a,i.onRender&&i.onRender()),i.onPropertyNameChange&&i.onPropertyNameChange(e.propertyName||"")})}else if(!r&&n){let s=this.propertyNameInput.previousElementSibling;s&&s.classList.contains("noteMover-mobile-trigger-field-label")&&s.remove(),this.propertyNameInput.remove(),this.propertyNameInput=null}else r&&n&&this.propertyNameInput&&(this.propertyNameInput.value=e.propertyName||"")}getCardElement(){return this.cardEl}getCriteriaTypeSelect(){return this.criteriaTypeSelect}getOperatorSelect(){return this.operatorSelect}getPropertyNameInput(){return this.propertyNameInput}getValueInput(){return this.valueInput}};var oe=class extends x{constructor(t,i){super(t,{title:"Rule Editor",size:"large",cssClass:"noteMover-rule-editor-modal",autoFocus:!1});this.dragDropManager=null;this.triggersContainer=null;this.mobileTriggerCards=[];this.ruleOptions=i,this.workingRule=JSON.parse(JSON.stringify(i.rule))}createContent(){let{contentEl:t}=this;m.isMobile()?this.createMobileContent(t):this.createDesktopContent(t)}createMobileContent(t){let i=new ye(t,"Name",void 0,"Enter rule name",this.workingRule.name,async r=>{this.workingRule.name=r});new Ee(t,"Active","Enable or disable this rule",this.workingRule.active,async r=>{this.workingRule.active=r}),this.createMobileMatchConditions(t),this.createMobileDestination(t),t.createEl("hr",{cls:"noteMover-rule-editor-separator"}),this.createMobileConditionsSection(t),t.createEl("hr",{cls:"noteMover-rule-editor-separator"}),this.createMobileFooterActions(t)}createDesktopContent(t){this.createNameAndActiveRow(t),this.createMatchConditionsSelector(t),this.createDestinationInput(t),t.createEl("hr",{cls:"noteMover-rule-editor-separator"}),this.createConditionsSection(t),t.createEl("hr",{cls:"noteMover-rule-editor-separator"}),this.createFooterActions(t)}createNameAndActiveRow(t){let r=new k.Setting(t).setName("Name").addText(n=>n.setPlaceholder("Enter rule name").setValue(this.workingRule.name).onChange(s=>{this.workingRule.name=s})).addToggle(n=>n.setValue(this.workingRule.active).setTooltip(this.workingRule.active?"Rule is active":"Rule is inactive").onChange(s=>{this.workingRule.active=s,n.setTooltip(s?"Rule is active":"Rule is inactive")})).controlEl.querySelector('input[type="text"]');r&&(r.style.width="100%")}createMobileMatchConditions(t){let i=t.createDiv({cls:"noteMover-mobile-modal-card"});i.createDiv({cls:"noteMover-mobile-modal-card-header"}).createDiv({cls:"noteMover-mobile-modal-card-title",text:"Match Conditions"});let s=i.createDiv({cls:"noteMover-mobile-modal-card-content"}).createDiv({cls:"noteMover-rule-aggregation-buttons-mobile"});["all","any","none"].forEach(a=>{let c=s.createEl("button",{text:a.charAt(0).toUpperCase()+a.slice(1),cls:"noteMover-rule-aggregation-button"});this.workingRule.aggregation===a&&c.addClass("is-active"),c.onclick=()=>{this.workingRule.aggregation=a,s.querySelectorAll(".noteMover-rule-aggregation-button").forEach(u=>{u.removeClass("is-active")}),c.addClass("is-active")}})}createMatchConditionsSelector(t){let r=new k.Setting(t).setName("Match Conditions").controlEl.createDiv({cls:"noteMover-rule-aggregation-buttons"});["all","any","none"].forEach(s=>{let o=r.createEl("button",{text:s.charAt(0).toUpperCase()+s.slice(1),cls:"noteMover-rule-aggregation-button"});this.workingRule.aggregation===s&&o.addClass("is-active"),o.onclick=()=>{this.workingRule.aggregation=s,r.querySelectorAll(".noteMover-rule-aggregation-button").forEach(a=>{a.removeClass("is-active")}),o.addClass("is-active")}})}createMobileDestination(t){let i=t.createDiv({cls:"noteMover-mobile-modal-card"});i.createDiv({cls:"noteMover-mobile-modal-card-header"}).createDiv({cls:"noteMover-mobile-modal-card-title",text:"Destination"}),i.createDiv({cls:"noteMover-mobile-modal-card-description",text:"Folder where files matching this rule will be moved"});let o=i.createDiv({cls:"noteMover-mobile-modal-card-content"}).createDiv({cls:"search-input-container"}).createEl("input",{type:"text",cls:"noteMover-mobile-text-input",placeholder:"Example: folder1/folder2",value:this.workingRule.destination});new I(this.app,o),o.addEventListener("input",()=>{this.workingRule.destination=o.value})}createDestinationInput(t){let i=new k.Setting(t).setName("Destination").setDesc("Folder where files matching this rule will be moved").addSearch(r=>{new I(this.app,r.inputEl),r.setPlaceholder("Example: folder1/folder2").setValue(this.workingRule.destination).onChange(n=>{this.workingRule.destination=n}),r.inputEl.style.width="100%"})}createMobileConditionsSection(t){let r=new Me(t,"Conditions").getSectionElement();this.triggersContainer=r.createDiv({cls:"noteMover-rule-triggers-container"}),this.renderMobileTriggers(),new B(r,"",void 0,"+ Add Condition",()=>{this.workingRule.triggers.push({criteriaType:"tag",operator:"includes item",value:""}),this.renderMobileTriggers()},{})}createConditionsSection(t){let i=t.createDiv({cls:"noteMover-rule-conditions-section"});i.createEl("h3",{text:"Conditions:",cls:"noteMover-rule-conditions-title"}),this.triggersContainer=i.createDiv({cls:"noteMover-rule-triggers-container"}),this.renderTriggers();let r=new k.Setting(i).addButton(n=>n.setButtonText("+ Add Condition").onClick(()=>{this.workingRule.triggers.push({criteriaType:"tag",operator:"includes item",value:""}),this.renderTriggers()}))}renderMobileTriggers(){this.triggersContainer&&(this.triggersContainer.empty(),this.mobileTriggerCards=[],this.workingRule.triggers.forEach((t,i)=>{let r={onCriteriaTypeChange:()=>{this.renderMobileTriggers()},onOperatorChange:()=>{this.renderMobileTriggers()},onPropertyNameChange:()=>{this.renderMobileTriggers()},onValueChange:()=>{},onMoveUp:()=>{if(i>0){let[s]=this.workingRule.triggers.splice(i,1);this.workingRule.triggers.splice(i-1,0,s),this.renderMobileTriggers()}},onMoveDown:()=>{if(i<this.workingRule.triggers.length-1){let[s]=this.workingRule.triggers.splice(i,1);this.workingRule.triggers.splice(i+1,0,s),this.renderMobileTriggers()}},onDelete:()=>{this.workingRule.triggers.splice(i,1),this.workingRule.triggers.length===0&&this.workingRule.triggers.push({criteriaType:"tag",operator:"includes item",value:""}),this.renderMobileTriggers()},canMoveUp:i>0,canMoveDown:i<this.workingRule.triggers.length-1,onRender:()=>{this.renderMobileTriggers()}},n=new be(this.triggersContainer,t,r,this.app);this.mobileTriggerCards.push(n)}))}renderTriggers(){this.triggersContainer&&(this.triggersContainer.empty(),this.dragDropManager&&(this.dragDropManager.destroy(),this.dragDropManager=null),this.workingRule.triggers.forEach((t,i)=>{this.createTriggerRow(this.triggersContainer,t,i)}),this.setupTriggersDragDrop())}createTriggerRow(t,i,r){let n=t.createDiv({cls:"noteMover-rule-trigger-row"}),s=n.createEl("button",{cls:"noteMover-rule-trigger-delete-btn clickable-icon"});(0,k.setIcon)(s,"x"),s.onclick=()=>{this.workingRule.triggers.splice(r,1),this.workingRule.triggers.length===0&&this.workingRule.triggers.push({criteriaType:"tag",operator:"includes item",value:""}),this.renderTriggers()};let o=n.createEl("select",{cls:"dropdown noteMover-rule-criteria-type"});["tag","fileName","folder","created_at","modified_at","extension","links","embeds","properties","headings"].forEach(E=>{let S=o.createEl("option",{value:E,text:E});i.criteriaType===E&&(S.selected=!0)}),o.onchange=()=>{i.criteriaType=o.value,i.operator=se(i.criteriaType),i.criteriaType!=="properties"&&(delete i.propertyName,delete i.propertyType),this.renderTriggers()};let c=n.createEl("select",{cls:"dropdown noteMover-rule-operator"});this.populateOperatorDropdown(c,i);let u=null;i.criteriaType==="properties"&&(u=n.createEl("input",{type:"text",cls:"noteMover-rule-property-name",placeholder:"Property Name",value:i.propertyName||""}),new G(this.app,u),u.oninput=()=>{i.propertyName=u.value;let E=ve(this.app,i.propertyName);E&&(i.propertyType=E,this.renderTriggers())});let p=null;A(i.operator)&&(p=n.createEl("input",{type:"text",cls:"noteMover-rule-trigger-value",placeholder:i.criteriaType==="tag"?"#tag":"Value",value:i.value}),p.oninput=()=>{i.value=p.value},i.criteriaType==="tag"?new X(this.app,p):i.criteriaType==="folder"?new I(this.app,p):i.criteriaType==="properties"&&i.propertyName&&i.propertyType&&new q(this.app,p,i.propertyName,i.propertyType)),A(i.operator)||n.addClass("noteMover-no-value-field");let y=n.createDiv({cls:"noteMover-drag-handle-container"}),M=C.createDragHandle();y.appendChild(M)}populateOperatorDropdown(t,i){t.empty();let r;i.criteriaType==="properties"&&i.propertyType?r=_(i.propertyType):r=j(i.criteriaType),r.forEach(n=>{let s=t.createEl("option",{value:n,text:n});i.operator===n&&(s.selected=!0)}),t.onchange=()=>{i.operator=t.value,this.renderTriggers()}}setupTriggersDragDrop(){this.triggersContainer&&(this.dragDropManager=new C(this.triggersContainer,{onReorder:(t,i)=>{let[r]=this.workingRule.triggers.splice(t,1),n=t<i?i-1:i;this.workingRule.triggers.splice(n,0,r);let o=Array.from(this.triggersContainer.querySelectorAll(".noteMover-rule-trigger-row"))[t];if(o){o.remove();let a=Array.from(this.triggersContainer.querySelectorAll(".noteMover-rule-trigger-row"));n>=a.length?this.triggersContainer.appendChild(o):a[n].before(o)}},onSave:async()=>Promise.resolve(),itemSelector:".noteMover-rule-trigger-row",handleSelector:".noteMover-drag-handle"}))}createMobileFooterActions(t){let i=t.createDiv({cls:"noteMover-rule-editor-footer-mobile"});this.ruleOptions.isEditMode&&this.ruleOptions.onDelete&&new B(i,"",void 0,"Remove Rule",async()=>{confirm(`Are you sure you want to delete the rule "${this.workingRule.name}"?

This action cannot be undone.`)&&this.ruleOptions.onDelete&&(await this.ruleOptions.onDelete(),this.close())},{isDanger:!0}),new B(i,"",void 0,"Cancel",()=>{this.close()},{}),new B(i,"",void 0,"Save",async()=>{this.validateRule()&&(await this.ruleOptions.onSave(this.workingRule),this.close())},{isPrimary:!0})}createFooterActions(t){let i=t.createDiv({cls:"noteMover-rule-editor-footer"});if(this.ruleOptions.isEditMode&&this.ruleOptions.onDelete){let n=i.createDiv({cls:"noteMover-rule-editor-footer-left"});new k.Setting(n).addButton(s=>s.setButtonText("Remove Rule").setWarning().onClick(async()=>{confirm(`Are you sure you want to delete the rule "${this.workingRule.name}"?

This action cannot be undone.`)&&this.ruleOptions.onDelete&&(await this.ruleOptions.onDelete(),this.close())}))}let r=i.createDiv({cls:"noteMover-rule-editor-footer-right"});new k.Setting(r).addButton(n=>n.setButtonText("Cancel").onClick(()=>{this.close()})).addButton(n=>n.setButtonText("Save").setCta().onClick(async()=>{this.validateRule()&&(await this.ruleOptions.onSave(this.workingRule),this.close())}))}validateRule(){if(!this.workingRule.name||this.workingRule.name.trim()==="")return alert("Rule name cannot be empty."),!1;if(!this.workingRule.destination||this.workingRule.destination.trim()==="")return alert("Destination folder cannot be empty."),!1;if(this.workingRule.triggers.length===0)return alert("At least one condition is required."),!1;for(let t=0;t<this.workingRule.triggers.length;t++){let i=this.workingRule.triggers[t];if(A(i.operator)){if(!i.value||i.value.trim()==="")return alert(`Condition ${t+1}: Value cannot be empty.`),!1;if(Fe(i.operator))try{new RegExp(i.value)}catch(r){return alert(`Condition ${t+1}: Invalid regex pattern: ${r instanceof Error?r.message:"Unknown error"}`),!1}}}return!0}onClose(){this.dragDropManager&&(this.dragDropManager.destroy(),this.dragDropManager=null),super.onClose()}};var ae=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i;this.dragDropManager=null;this.advancedSuggestInstances=[]}addRulesSetting(){new $.Setting(this.containerEl).setName("Rules").setHeading();let e=document.createDocumentFragment();e.append("The NoteMover will move files to the folder associated with the specified criteria.",document.createElement("br"),"Criteria can be tags, filenames, paths, content, properties, or dates. If multiple rules match, the first one will be applied."),new $.Setting(this.containerEl).setDesc(e);let t=document.createDocumentFragment();t.append("Enable the new Rule V2 system (beta). This provides more flexible rule matching with multiple conditions and logical operators.",document.createElement("br"),"\u26A0\uFE0F Beta feature: Rule V2 replaces the existing rule system when enabled. Your existing rules will be migrated automatically."),new $.Setting(this.containerEl).setName("Enable Rule-V2 (beta)").setDesc(t).addToggle(i=>{var r;return i.setValue((r=this.plugin.settings.settings.enableRuleV2)!=null?r:!1).onChange(async n=>{this.plugin.settings.settings.enableRuleV2=n,await this.plugin.save_settings(),this.refreshDisplay()})})}addAddRuleButtonSetting(){this.plugin.settings.settings.enableRuleV2?this.addAddRuleV2ButtonSetting():this.addAddRuleV1ButtonSetting()}addAddRuleV1ButtonSetting(){new $.Setting(this.containerEl).addButton(e=>e.setButtonText("Add new rule").setCta().onClick(async()=>{this.plugin.settings.settings.rules.push({criteria:"",path:""}),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()}))}addAddRuleV2ButtonSetting(){new $.Setting(this.containerEl).addButton(e=>e.setButtonText("+ Add Rule").setCta().onClick(()=>{this.openRuleEditorModal(null)}))}addRulesArray(){this.plugin.settings.settings.enableRuleV2?this.addRulesV2Array():this.addRulesV1Array()}addRulesV1Array(){this.cleanupAdvancedSuggestInstances();let e=m.isMobile(),t=document.createElement("div");t.className="noteMover-rules-container",e&&t.addClass("noteMover-mobile-rules-container"),this.containerEl.appendChild(t),this.setupDragDropManager(t),this.plugin.settings.settings.rules.forEach((i,r)=>{let n=new $.Setting(t).addSearch(s=>{let o=new N(this.app,s.inputEl);this.advancedSuggestInstances.push(o),s.setPlaceholder(d.PLACEHOLDER_TEXTS.CRITERIA).setValue(i.criteria).onChange(async a=>{if(a&&this.plugin.settings.settings.rules.some(c=>c.criteria===a)){h(v("This criteria already has a folder associated with it"),"Rules setting",!1);return}this.plugin.settings.settings.rules[r].criteria=a,await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager()}),s.containerEl.addClass("noteMover-search")}).addSearch(s=>{new I(this.app,s.inputEl),s.setPlaceholder(d.PLACEHOLDER_TEXTS.PATH).setValue(i.path).onChange(async o=>{this.plugin.settings.settings.rules[r].path=o,await this.plugin.save_settings()}),s.containerEl.addClass("noteMover-search")}).addExtraButton(s=>s.setIcon("cross").onClick(async()=>{this.plugin.settings.settings.rules.splice(r,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()}));if(this.addDragHandle(n.settingEl,r),n.infoEl.remove(),e){n.settingEl.addClass("noteMover-mobile-rule-item");let s=n.settingEl.querySelector(".setting-item-control");s&&s.addClass("noteMover-mobile-rule-controls")}})}moveRule(e,t){let i=this.plugin.settings.settings.rules,r=Math.max(0,Math.min(i.length-1,e+t));[i[e],i[r]]=[i[r],i[e]],this.plugin.save_settings(),this.refreshDisplay()}setupDragDropManager(e){this.dragDropManager&&this.dragDropManager.destroy(),this.dragDropManager=new C(e,{onReorder:(t,i)=>{this.reorderRules(t,i)},onSave:async()=>{await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()},itemSelector:".setting-item",handleSelector:".noteMover-drag-handle"})}addDragHandle(e,t){let i=C.createDragHandle(),r=document.createElement("div");r.className="noteMover-drag-handle-container",r.appendChild(i),e.insertBefore(r,e.firstChild),e.classList.add("noteMover-with-drag-handle")}reorderRules(e,t){if(e===t)return;let i=this.plugin.settings.settings.rules,[r]=i.splice(e,1);i.splice(t,0,r)}get app(){return this.plugin.app}cleanupAdvancedSuggestInstances(){this.advancedSuggestInstances.forEach(e=>{e.destroy()}),this.advancedSuggestInstances=[]}cleanup(){this.cleanupAdvancedSuggestInstances(),this.dragDropManager&&(this.dragDropManager.destroy(),this.dragDropManager=null)}addRulesV2Array(){this.plugin.settings.settings.rulesV2||(this.plugin.settings.settings.rulesV2=[]);let e=m.isMobile(),t=document.createElement("div");t.className="noteMover-rules-v2-container",e&&t.addClass("noteMover-mobile-rules-container"),this.containerEl.appendChild(t),this.setupDragDropManagerV2(t),this.plugin.settings.settings.rulesV2.forEach((i,r)=>{let n=new $.Setting(t);n.infoEl.remove();let s=n.settingEl.createDiv({cls:"noteMover-rule-v2-custom-container"});e&&s.addClass("noteMover-mobile-rule-container");let o=s.createDiv({cls:"noteMover-rule-v2-name"});o.textContent=i.name||"Unnamed Rule";let a=s.createDiv({cls:"noteMover-rule-v2-actions"});e&&a.addClass("noteMover-mobile-rule-actions"),n.addExtraButton(y=>y.setIcon("trash").setTooltip("Delete rule").onClick(async()=>{confirm(`Are you sure you want to delete the rule "${i.name}"?

This action cannot be undone.`)&&(this.plugin.settings.settings.rulesV2.splice(r,1),await this.plugin.save_settings(),this.refreshDisplay())})),n.addExtraButton(y=>y.setIcon("pencil").setTooltip("Edit rule").onClick(()=>{this.openRuleEditorModal(r)})),n.addToggle(y=>y.setValue(i.active).setTooltip(i.active?"Rule is active":"Rule is inactive").onChange(async M=>{this.plugin.settings.settings.rulesV2[r].active=M,await this.plugin.save_settings()}));let c=n.settingEl.querySelector(".setting-item-control");c&&a.appendChild(c);let u=a.createDiv({cls:"noteMover-drag-handle-container"}),p=C.createDragHandle();u.appendChild(p)})}setupDragDropManagerV2(e){this.dragDropManager&&this.dragDropManager.destroy(),this.dragDropManager=new C(e,{onReorder:(t,i)=>{this.reorderRulesV2(t,i)},onSave:async()=>{await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay()},itemSelector:".setting-item",handleSelector:".noteMover-drag-handle"})}reorderRulesV2(e,t){if(e===t||!this.plugin.settings.settings.rulesV2)return;let i=this.plugin.settings.settings.rulesV2,[r]=i.splice(e,1);i.splice(t,0,r)}openRuleEditorModal(e){let t=e!==null,i;t?i=JSON.parse(JSON.stringify(this.plugin.settings.settings.rulesV2[e])):i={name:"New Rule",destination:"",aggregation:"all",triggers:[{criteriaType:"tag",operator:"includes item",value:""}],active:!0},new oe(this.app,{rule:i,isEditMode:t,onSave:async n=>{this.plugin.settings.settings.rulesV2||(this.plugin.settings.settings.rulesV2=[]),t?this.plugin.settings.settings.rulesV2[e]=n:this.plugin.settings.settings.rulesV2.push(n),await this.plugin.save_settings(),this.refreshDisplay()},onDelete:t?async()=>{this.plugin.settings.settings.rulesV2.splice(e,1),await this.plugin.save_settings(),this.refreshDisplay()}:void 0}).open()}};var Te=require("obsidian");var rt=require("obsidian");var U=class l extends x{constructor(t,i){super(t,{cssClass:"noteMover-confirm-modal",size:"small",...i});this.resolvePromise=()=>{};this.confirmOptions={confirmText:"OK",cancelText:"Cancel",danger:!1,...i}}createContent(){let{contentEl:t}=this,i=m.isMobile(),r=t.createEl("div",{cls:i?"noteMover-confirm-modal-message noteMover-confirm-modal-message-mobile":"noteMover-confirm-modal-message"});if(r.innerHTML=this.confirmOptions.message,i){let s=new rt.Setting(t).addButton(c=>{c.setButtonText(this.confirmOptions.confirmText||"OK").setCta().onClick(()=>{this.resolvePromise(!0),this.close()}),this.confirmOptions.danger&&c.setWarning()}).settingEl.querySelector("button");s&&(s.style.width="100%",s.style.minHeight="48px");let a=new rt.Setting(t).addButton(c=>{c.setButtonText(this.confirmOptions.cancelText||"Cancel").onClick(()=>{this.resolvePromise(!1),this.close()})}).settingEl.querySelector("button");a&&(a.style.width="100%",a.style.minHeight="48px")}else{let n=this.createButtonContainer(t);this.createButton(n,this.confirmOptions.cancelText||"Cancel",()=>{this.resolvePromise(!1),this.close()}),this.createButton(n,this.confirmOptions.confirmText||"OK",()=>{this.resolvePromise(!0),this.close()},{isPrimary:!0,isWarning:this.confirmOptions.danger})}}onClose(){super.onClose(),this.resolvePromise(!1)}confirm(){return new Promise(t=>{this.resolvePromise=t,this.open()})}static async show(t,i){return new l(t,i).confirm()}};var le=class{constructor(e,t){this.plugin=e;this.containerEl=t}addHistorySettings(){let e=m.isMobile();new Te.Setting(this.containerEl).setName("History").setHeading(),this.addRetentionPolicySettings();let t=new Te.Setting(this.containerEl).setName("Clear history").setDesc("Clears the history of moved notes").addButton(i=>i.setButtonText(d.UI_TEXTS.CLEAR_HISTORY).setWarning().onClick(async()=>{await U.show(this.app,{title:d.UI_TEXTS.CLEAR_HISTORY_TITLE,message:d.UI_TEXTS.CLEAR_HISTORY_MESSAGE,confirmText:d.UI_TEXTS.CLEAR_HISTORY_CONFIRM,cancelText:d.UI_TEXTS.CLEAR_HISTORY_CANCEL,danger:!0})&&await this.plugin.historyManager.clearHistory()}));if(e){t.settingEl.addClass("noteMover-mobile-optimized");let i=t.settingEl.querySelector(".setting-item-control");i&&i.addClass("noteMover-mobile-button-control")}}addRetentionPolicySettings(){let e=m.isMobile();this.plugin.settings.settings.retentionPolicy||(this.plugin.settings.settings.retentionPolicy={...D.DEFAULT_RETENTION_POLICY});let t=this.plugin.settings.settings.retentionPolicy,i=new Te.Setting(this.containerEl).setName(d.UI_TEXTS.RETENTION_POLICY_TITLE).setDesc(d.UI_TEXTS.RETENTION_POLICY_DESC).addText(n=>n.setPlaceholder("30").setValue(t.value.toString()).onChange(async s=>{let o=parseInt(s);!isNaN(o)&&o>0&&(this.plugin.settings.settings.retentionPolicy.value=o,await this.plugin.save_settings())})).addDropdown(n=>n.addOption("days",d.UI_TEXTS.RETENTION_POLICY_DAYS).addOption("weeks",d.UI_TEXTS.RETENTION_POLICY_WEEKS).addOption("months",d.UI_TEXTS.RETENTION_POLICY_MONTHS).setValue(t.unit).onChange(async s=>{this.plugin.settings.settings.retentionPolicy.unit=s,await this.plugin.save_settings()}));if(e){i.settingEl.addClass("noteMover-mobile-optimized");let n=i.settingEl.querySelector(".setting-item-control");n&&n.addClass("noteMover-mobile-retention-controls")}let r=new Te.Setting(this.containerEl).setName("Clean up old entries").setDesc(`Remove history entries older than ${t.value} ${t.unit}`).addButton(n=>n.setButtonText("Clean up now").setCta().onClick(async()=>{await this.plugin.historyManager.cleanupOldEntries()}));if(e){r.settingEl.addClass("noteMover-mobile-optimized");let n=r.settingEl.querySelector(".setting-item-control");n&&n.addClass("noteMover-mobile-button-control")}}get app(){return this.plugin.app}};var ke=require("obsidian");var V=class{static validateSettings(e){let t={isValid:!0,errors:[],warnings:[]};return!e||typeof e!="object"?(t.errors.push("Settings must be a valid object"),t.isValid=!1,t):this.looksLikePluginData(e)?this.validatePluginData(e):this.validateLegacySettings(e)}static looksLikePluginData(e){if(!e||typeof e!="object")return!1;if("settings"in e&&e.settings&&typeof e.settings=="object"){let t=e.settings;return"triggers"in t&&typeof t.triggers=="object"||"filters"in t&&typeof t.filters=="object"||Array.isArray(t.rules)}return!1}static validateLegacySettings(e){let t={isValid:!0,errors:[],warnings:[]},i=["destination","inboxLocation"];for(let n of i)this.validateStringField(e[n],n,t,!1)||(t.isValid=!1);let r=["enablePeriodicMovement","enableOnEditTrigger","enableFilter","enableRules"];for(let n of r)this.validateBooleanField(e[n],n,t,!1)||(t.isValid=!1);return e.periodicMovementInterval!==void 0&&e.periodicMovementInterval!==null&&!this.validateIntervalField(e.periodicMovementInterval,t)&&(t.isValid=!1),e.filter!==void 0&&e.filter!==null&&!this.validateFilterArray(e.filter,t)&&(t.isValid=!1),e.rules!==void 0&&e.rules!==null&&!this.validateRulesArray(e.rules,t)&&(t.isValid=!1),e.history!==void 0&&(this.validateHistoryArray(e.history,t)||t.warnings.push("History data is invalid and will be ignored")),e.bulkOperations!==void 0&&(this.validateBulkOperationsArray(e.bulkOperations,t)||t.warnings.push("Bulk operations data is invalid and will be ignored")),e.lastSeenVersion!==void 0&&(this.validateStringField(e.lastSeenVersion,"lastSeenVersion",t,!1)||t.warnings.push("Last seen version is invalid and will be ignored")),t}static validatePluginData(e){let t={isValid:!0,errors:[],warnings:[]},i=e.settings;if(!i||typeof i!="object")return t.errors.push('Field "settings" is required and must be an object'),t.isValid=!1,t;if(!i.triggers||typeof i.triggers!="object")t.errors.push('Field "settings.triggers" is required and must be an object'),t.isValid=!1;else{let r=i.triggers;this.validateBooleanField(r.enablePeriodicMovement,"settings.triggers.enablePeriodicMovement",t)||(t.isValid=!1),this.validateIntervalField(r.periodicMovementInterval,t)||(t.isValid=!1),this.validateBooleanField(r.enableOnEditTrigger,"settings.triggers.enableOnEditTrigger",t)||(t.isValid=!1)}if(!i.filters||typeof i.filters!="object")t.errors.push('Field "settings.filters" is required and must be an object'),t.isValid=!1;else{let r=i.filters;if(!Array.isArray(r.filter))t.errors.push('Field "settings.filters.filter" must be an array'),t.isValid=!1;else for(let n=0;n<r.filter.length;n++)if(!r.filter[n]||typeof r.filter[n]!="object"||typeof r.filter[n].value!="string"){t.errors.push(`Filter item at index ${n} must be an object with string 'value'`),t.isValid=!1;break}}if(this.validateRulesArray(i.rules,t)||(t.isValid=!1),i.rulesV2!==void 0&&(this.validateRulesV2Array(i.rulesV2,t)||(t.isValid=!1)),i.retentionPolicy!==void 0){let r=i.retentionPolicy;(!r||typeof r!="object"||typeof r.value!="number"||r.unit!=="days"&&r.unit!=="weeks"&&r.unit!=="months")&&t.warnings.push("Retention policy is invalid and will be ignored")}return e.lastSeenVersion!==void 0&&(this.validateStringField(e.lastSeenVersion,"lastSeenVersion",t,!1)||t.warnings.push("Last seen version is invalid and will be ignored")),t}static validateStringField(e,t,i,r=!0){return r&&e==null?(i.errors.push(`Field '${t}' is required`),!1):e!=null&&typeof e!="string"?(i.errors.push(`Field '${t}' must be a string`),!1):!0}static validateBooleanField(e,t,i,r=!0){return r&&e==null?(i.errors.push(`Field '${t}' is required`),!1):e!=null&&typeof e!="boolean"?(i.errors.push(`Field '${t}' must be a boolean`),!1):!0}static validateIntervalField(e,t){return e==null?(t.errors.push('Field "periodicMovementInterval" is required'),!1):typeof e!="number"||!Number.isInteger(e)?(t.errors.push('Field "periodicMovementInterval" must be an integer'),!1):e<1?(t.errors.push('Field "periodicMovementInterval" must be greater than 0'),!1):!0}static validateFilterArray(e,t){if(e==null)return t.errors.push('Field "filter" is required'),!1;if(!Array.isArray(e))return t.errors.push('Field "filter" must be an array'),!1;for(let i=0;i<e.length;i++)if(typeof e[i]!="string")return t.errors.push(`Filter item at index ${i} must be a string`),!1;return!0}static validateRulesArray(e,t){if(e==null)return t.errors.push('Field "rules" is required'),!1;if(!Array.isArray(e))return t.errors.push('Field "rules" must be an array'),!1;for(let i=0;i<e.length;i++)if(!this.validateRule(e[i],i,t))return!1;return!0}static validateRule(e,t,i){return!e||typeof e!="object"?(i.errors.push(`Rule at index ${t} must be an object`),!1):!(!this.validateStringField(e.criteria,`rules[${t}].criteria`,i)||!this.validateStringField(e.path,`rules[${t}].path`,i))}static validateHistoryArray(e,t){if(!Array.isArray(e))return!1;for(let i=0;i<e.length;i++){let r=e[i];if(!r||typeof r!="object"||typeof r.id!="string"||typeof r.timestamp!="number"||typeof r.sourcePath!="string"||typeof r.destinationPath!="string")return!1}return!0}static validateBulkOperationsArray(e,t){if(!Array.isArray(e))return!1;for(let i=0;i<e.length;i++){let r=e[i];if(!r||typeof r!="object"||typeof r.id!="string"||typeof r.timestamp!="number"||!Array.isArray(r.entries))return!1}return!0}static sanitizeSettings(e){let t={},i=["destination","inboxLocation","enablePeriodicMovement","periodicMovementInterval","enableFilter","filter","enableRules","rules","retentionPolicy","lastSeenVersion"];for(let r of i)e[r]!==void 0&&(t[r]=e[r]);return Array.isArray(e.history)&&(t.history=e.history),Array.isArray(e.bulkOperations)&&(t.bulkOperations=e.bulkOperations),t}static validateRulesV2Array(e,t){if(!e)return!0;if(!Array.isArray(e))return t.errors.push('Field "rulesV2" must be an array'),!1;for(let i=0;i<e.length;i++)if(!this.validateRuleV2(e[i],i,t))return!1;return!0}static validateRuleV2(e,t,i){if(!e||typeof e!="object")return i.errors.push(`RuleV2 at index ${t} must be an object`),!1;if(!this.validateStringField(e.name,`rulesV2[${t}].name`,i)||!this.validateStringField(e.destination,`rulesV2[${t}].destination`,i))return!1;if(!e.aggregation||typeof e.aggregation!="string")return i.errors.push(`RuleV2 at index ${t}: 'aggregation' is required and must be a string`),!1;if(!["all","any","none"].includes(e.aggregation))return i.errors.push(`RuleV2 at index ${t}: 'aggregation' must be one of: 'all', 'any', 'none'`),!1;if(typeof e.active!="boolean")return i.errors.push(`RuleV2 at index ${t}: 'active' is required and must be a boolean`),!1;if(!Array.isArray(e.triggers))return i.errors.push(`RuleV2 at index ${t}: 'triggers' is required and must be an array`),!1;if(e.triggers.length===0)return i.errors.push(`RuleV2 at index ${t}: 'triggers' array cannot be empty`),!1;for(let r=0;r<e.triggers.length;r++)if(!this.validateTrigger(e.triggers[r],t,r,i))return!1;return this.compileRegexInRuleV2(e,t,i),!0}static validateTrigger(e,t,i,r){let n=`rulesV2[${t}].triggers[${i}]`;if(!e||typeof e!="object")return r.errors.push(`${n} must be an object`),!1;let s=["tag","fileName","folder","created_at","modified_at","extension","links","embeds","properties","headings"];if(!e.criteriaType||typeof e.criteriaType!="string")return r.errors.push(`${n}.criteriaType is required and must be a string`),!1;if(!s.includes(e.criteriaType))return r.errors.push(`${n}.criteriaType must be one of: ${s.join(", ")}`),!1;if(!e.operator||typeof e.operator!="string")return r.errors.push(`${n}.operator is required and must be a string`),!1;if(e.criteriaType==="properties"){if(!e.propertyName||typeof e.propertyName!="string")return r.errors.push(`${n}.propertyName is required for properties criteria and must be a string`),!1;if(e.propertyType){let o=["text","number","checkbox","date","list"];if(!o.includes(e.propertyType))return r.errors.push(`${n}.propertyType must be one of: ${o.join(", ")}`),!1}if(e.propertyType){if(!tt(e.operator,e.propertyType)){let o=_(e.propertyType);return r.errors.push(`${n}.operator '${e.operator}' is not valid for propertyType '${e.propertyType}'. Valid operators: ${o.join(", ")}`),!1}}else{let o=["text","number","checkbox","date","list"];if(!o.some(c=>tt(e.operator,c))){let c=Array.from(new Set(o.flatMap(u=>_(u))));return r.errors.push(`${n}.operator '${e.operator}' is not valid for criteriaType '${e.criteriaType}'. Valid operators: ${c.join(", ")}`),!1}}}else if(!pt(e.operator,e.criteriaType)){let o=j(e.criteriaType);return r.errors.push(`${n}.operator '${e.operator}' is not valid for criteriaType '${e.criteriaType}'. Valid operators: ${o.join(", ")}`),!1}return!(A(e.operator)&&!this.validateStringField(e.value,`${n}.value`,r))}static compileRegexInRuleV2(e,t,i){let r=!1;for(let n=0;n<e.triggers.length;n++){let s=e.triggers[n];if(Fe(s.operator))try{new RegExp(s.value)}catch(o){r=!0;let a=o instanceof Error?o.message:"Unknown error";i.errors.push(`RuleV2 at index ${t}, trigger ${n}: Invalid regex pattern '${s.value}': ${a}`)}}r&&(e.active=!1,i.warnings.push(`RuleV2 at index ${t} has been set to inactive due to invalid regex pattern(s)`))}};var P=class{static migrateRules(e){return!Array.isArray(e)||e.length===0?[]:e.map((t,i)=>this.migrateRule(t,i)).filter(t=>t!==null)}static migrateRule(e,t){if(!e||!e.criteria||!e.path)return null;let i=e.criteria.match(/^([a-zA-Z_]+):\s*(.*)$/);if(!i)return{name:`Rule ${t+1} (Invalid format)`,destination:e.path||"",aggregation:"all",triggers:[{criteriaType:"tag",operator:"includes item",value:""}],active:!1};let r=i[1],n=i[2],s=this.mapV1ToV2Trigger(r,n);return s?{name:this.generateRuleName(r,n,t),destination:e.path,aggregation:"all",triggers:[s],active:!0}:{name:`Rule ${t+1} (Unsupported: ${r})`,destination:e.path,aggregation:"all",triggers:[{criteriaType:"tag",operator:"includes item",value:""}],active:!1}}static mapV1ToV2Trigger(e,t){let i,r;switch(e){case"tag":i="tag",r="includes item";break;case"fileName":i="fileName",r="contains";break;case"path":i="folder",r="starts with";break;case"content":return null;case"created_at":i="created_at",r="date is";break;case"updated_at":i="modified_at",r="date is";break;case"property":i="properties",r="has any value";break;default:return null}let n={criteriaType:i,operator:r,value:t};if(i==="properties"){let s=t.indexOf(":");s!==-1?(n.propertyName=t.substring(0,s).trim(),n.value=t.substring(s+1).trim(),n.propertyType="text",n.operator="contains"):(n.propertyName=t,n.value="",n.propertyType="text",n.operator="has any value")}return n}static generateRuleName(e,t,i){let r=t.length>30?t.substring(0,30)+"...":t;switch(e){case"tag":return`Tag: ${r}`;case"fileName":return`Filename: ${r}`;case"path":return`Folder: ${r}`;case"created_at":return`Created: ${r}`;case"updated_at":return`Modified: ${r}`;case"property":return`Property: ${r}`;default:return`Rule ${i+1}`}}static shouldMigrate(e,t){return Array.isArray(e)&&e.length>0&&(!t||t.length===0)}static migrateRuleV2Triggers(e){if(!Array.isArray(e))return!1;let t=!1;for(let i of e)if(!(!i.triggers||!Array.isArray(i.triggers))){for(let r of i.triggers)if(r.ruleType&&!r.operator){let n=r.ruleType,s=this.mapRuleTypeToOperator(n,r.criteriaType);s&&(r.operator=s,delete r.ruleType,t=!0)}}return t}static mapRuleTypeToOperator(e,t){if(t==="tag"||t==="links"||t==="embeds")switch(e){case"contains":return"includes item";case"does not contain":return"does not include item";default:return this.findMatchingOperator(e,t)}if(t==="fileName"||t==="folder"||t==="extension"||t==="headings"){let i={contains:"contains","does not contain":"does not contain","starts with":"starts with","ends with":"ends with",is:"is","is not":"is not"};return i[e]?i[e]:this.findMatchingOperator(e,t)}return t==="properties"?e==="contains"?"contains":"has any value":t==="created_at"||t==="modified_at"?this.findMatchingOperator(e,t):this.findMatchingOperator(e,t)}static findMatchingOperator(e,t){let i=se(t);return["is","is not","contains","does not contain","starts with","does not starts with","ends with","does not ends with","match regex","does not match regex","includes item","does not include item","all are","all start with","all end with","all match regex","any contain","any end with","any match regex","none contain","none start with","none end with","count is","count is not","count is less than","count is more than","date is","date is not","date is today","date is not today","date is before","date is after","is before","is after","has any value","has no value","property is present","property is missing","equals","does not equal","is less than","is more than"].find(s=>s.toLowerCase()===e.toLowerCase())||i}};var ce=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i}addImportExportSettings(){let e=m.isMobile();new ke.Setting(this.containerEl).setName("Import/Export").setHeading();let t=new ke.Setting(this.containerEl).setName("Export settings").setDesc("Export your current settings as a JSON file").addButton(r=>r.setButtonText(d.UI_TEXTS.EXPORT_SETTINGS).setCta().onClick(async()=>{await this.exportSettings()}));if(e){t.settingEl.addClass("noteMover-mobile-optimized");let r=t.settingEl.querySelector(".setting-item-control");r&&r.addClass("noteMover-mobile-button-control")}let i=new ke.Setting(this.containerEl).setName("Import settings").setDesc("Import settings from a JSON file").addButton(r=>r.setButtonText(d.UI_TEXTS.IMPORT_SETTINGS).setWarning().onClick(async()=>{await this.importSettings()}));if(e){i.settingEl.addClass("noteMover-mobile-optimized");let r=i.settingEl.querySelector(".setting-item-control");r&&r.addClass("noteMover-mobile-button-control")}}async exportSettings(){try{let e={settings:this.plugin.settings.settings,lastSeenVersion:this.plugin.settings.lastSeenVersion};this.plugin.settings.schemaVersion&&(e.schemaVersion=this.plugin.settings.schemaVersion);let t=JSON.stringify(e,null,2),i=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=`note-mover-settings-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),g.info(d.UI_TEXTS.EXPORT_SUCCESS)}catch(e){h(v(`Export failed: ${e.message}`),"Export settings",!1)}}async importSettings(){try{let e=document.createElement("input");e.type="file",e.accept=".json",e.style.display="none",document.body.appendChild(e);let t=await new Promise((o,a)=>{e.onchange=c=>{let u=c.target;u.files&&u.files[0]?o(u.files[0]):a(new Error("No file selected"))},e.click()});document.body.removeChild(e);let i=await this.readFileAsText(t),r;try{r=JSON.parse(i)}catch(o){h(v(d.UI_TEXTS.INVALID_FILE),"Import settings",!1);return}let n=V.validateSettings(r);if(!n.isValid){let o=`${d.UI_TEXTS.VALIDATION_ERRORS}:
${n.errors.join(`
`)}`;h(v(o),"Import settings",!1);return}if(n.warnings.length>0&&g.warning(`Import warnings: ${n.warnings.join(", ")}`),await U.show(this.app,{title:d.UI_TEXTS.IMPORT_SETTINGS_TITLE,message:d.UI_TEXTS.IMPORT_SETTINGS_MESSAGE,confirmText:d.UI_TEXTS.IMPORT_SETTINGS_CONFIRM,cancelText:d.UI_TEXTS.IMPORT_SETTINGS_CANCEL,danger:!0})){let o=this.plugin.settings;if(r&&typeof r=="object"&&r.settings&&typeof r.settings=="object"){let a=r.settings;if(a.triggers&&typeof a.triggers=="object"&&(a.triggers.enablePeriodicMovement!==void 0&&(o.settings.triggers.enablePeriodicMovement=!!a.triggers.enablePeriodicMovement),a.triggers.periodicMovementInterval!==void 0&&(o.settings.triggers.periodicMovementInterval=Number(a.triggers.periodicMovementInterval)),a.triggers.enableOnEditTrigger!==void 0&&(o.settings.triggers.enableOnEditTrigger=!!a.triggers.enableOnEditTrigger)),a.filters&&typeof a.filters=="object"){let c=Array.isArray(a.filters.filter)?a.filters.filter:[];o.settings.filters.filter=c.filter(u=>u&&typeof u.value=="string").map(u=>({value:String(u.value)}))}Array.isArray(a.rules)&&(o.settings.rules=a.rules),a.retentionPolicy&&(o.settings.retentionPolicy=a.retentionPolicy),r.lastSeenVersion!==void 0&&(o.lastSeenVersion=r.lastSeenVersion),r.schemaVersion!==void 0&&(o.schemaVersion=r.schemaVersion),a.enableRuleV2!==void 0&&(o.settings.enableRuleV2=!!a.enableRuleV2),a.rulesV2!==void 0&&(o.settings.rulesV2=a.rulesV2)}else{let a=V.sanitizeSettings(r);a.enablePeriodicMovement!==void 0&&(o.settings.triggers.enablePeriodicMovement=!!a.enablePeriodicMovement),a.periodicMovementInterval!==void 0&&(o.settings.triggers.periodicMovementInterval=Number(a.periodicMovementInterval)),a.enableOnEditTrigger!==void 0&&(o.settings.triggers.enableOnEditTrigger=!!a.enableOnEditTrigger),Array.isArray(a.filter)&&(o.settings.filters.filter=a.filter.filter(c=>typeof c=="string").map(c=>({value:c}))),Array.isArray(a.rules)&&(o.settings.rules=a.rules),a.retentionPolicy&&(o.settings.retentionPolicy=a.retentionPolicy),a.lastSeenVersion!==void 0&&(o.lastSeenVersion=a.lastSeenVersion)}o.settings.enableRuleV2&&P.shouldMigrate(o.settings.rules,o.settings.rulesV2)&&(console.log("Migrating imported Rule V1 to Rule V2..."),o.settings.rulesV2=P.migrateRules(o.settings.rules),console.log(`Migrated ${o.settings.rulesV2.length} imported rules to V2 format`)),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay(),g.success(d.UI_TEXTS.IMPORT_SUCCESS)}}catch(e){e.message!=="File selection cancelled"&&h(v(`Import failed: ${e.message}`),"Import settings",!1)}}readFileAsText(e){return new Promise((t,i)=>{let r=new FileReader;r.onload=n=>{var s;(s=n.target)!=null&&s.result?t(n.target.result):i(new Error("Failed to read file"))},r.onerror=()=>i(new Error("Failed to read file")),r.readAsText(e)})}get app(){return this.plugin.app}};var ue=class{constructor(){this.timeouts=new Map}debounce(e,t,i=100){return((...r)=>{let n=this.timeouts.get(e);n&&clearTimeout(n);let s=setTimeout(()=>{t(...r),this.timeouts.delete(e)},i);this.timeouts.set(e,s)})}cancel(e){let t=this.timeouts.get(e);t&&(clearTimeout(t),this.timeouts.delete(e))}cancelAll(){this.timeouts.forEach(e=>clearTimeout(e)),this.timeouts.clear()}isPending(e){return this.timeouts.has(e)}};var W=class{constructor(e,t,i){this.descriptionEl=null;this.cardEl=e.createDiv({cls:"noteMover-mobile-setting-card"}),this.headerEl=this.cardEl.createDiv({cls:"noteMover-mobile-setting-header"}),this.titleEl=this.headerEl.createDiv({cls:"noteMover-mobile-setting-title"}),this.titleEl.textContent=t,i&&(this.descriptionEl=this.cardEl.createDiv({cls:"noteMover-mobile-setting-description"}),this.descriptionEl.textContent=i),this.controlEl=this.cardEl.createDiv({cls:"noteMover-mobile-setting-control"})}getCardElement(){return this.cardEl}getControlElement(){return this.controlEl}setDescription(e){this.descriptionEl?this.descriptionEl.textContent=e:(this.descriptionEl=this.cardEl.createDiv({cls:"noteMover-mobile-setting-description"}),this.descriptionEl.textContent=e)}addClass(e){this.cardEl.addClass(e)}};var z=class{constructor(e,t,i,r,n){this.settingItem=new W(e,t,i),this.settingItem.addClass("noteMover-mobile-toggle-setting");let o=this.settingItem.getCardElement().querySelector(".noteMover-mobile-setting-header");if(!o)throw new Error("Header element not found");this.toggleEl=o.createDiv({cls:"noteMover-mobile-toggle-switch"}),this.toggleInput=document.createElement("input"),this.toggleInput.type="checkbox",this.toggleInput.className="noteMover-mobile-toggle-input",this.toggleInput.checked=r,this.toggleEl.appendChild(this.toggleInput);let a=this.toggleEl.createDiv({cls:"noteMover-mobile-toggle-slider"});this.updateToggleState(r),this.toggleInput.addEventListener("change",async()=>{let u=this.toggleInput.checked;this.updateToggleState(u),await n(u)}),this.toggleEl.addEventListener("click",u=>{u.target!==this.toggleInput&&this.toggleInput.click()});let c=this.settingItem.getControlElement();c.style.display="none"}updateToggleState(e){e?this.toggleEl.addClass("is-active"):this.toggleEl.removeClass("is-active")}setValue(e){this.toggleInput.checked=e,this.updateToggleState(e)}getValue(){return this.toggleInput.checked}getCardElement(){return this.settingItem.getCardElement()}};var Ve=class{constructor(e,t,i,r,n,s){this.settingItem=new W(e,t,i),this.settingItem.addClass("noteMover-mobile-input-setting");let o=this.settingItem.getControlElement();this.inputEl=o.createEl("input",{cls:"noteMover-mobile-text-input",type:"text",attr:{placeholder:r,value:n}}),this.inputEl.addEventListener("input",async()=>{await s(this.inputEl.value)})}setValue(e){this.inputEl.value=e}getValue(){return this.inputEl.value}getInputElement(){return this.inputEl}getCardElement(){return this.settingItem.getCardElement()}};var He=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i;this.sectionContainer=this.containerEl.createDiv({cls:"noteMover-mobile-section-container"})}render(){this.sectionContainer.empty();let e=this.sectionContainer.createDiv({cls:"noteMover-mobile-section-heading"});e.textContent="Triggers",new z(this.sectionContainer,"Enable on-edit trigger","Move notes automatically when edited",this.plugin.settings.settings.triggers.enableOnEditTrigger===!0,async i=>{var r;this.plugin.settings.settings.triggers.enableOnEditTrigger=i,await this.plugin.save_settings(),(r=this.plugin.triggerHandler)==null||r.toggleOnEditListener()});let t=new z(this.sectionContainer,"Enable periodic movement","Move notes at regular intervals",this.plugin.settings.settings.triggers.enablePeriodicMovement,async i=>{var r;this.plugin.settings.settings.triggers.enablePeriodicMovement=i,await this.plugin.save_settings(),(r=this.plugin.triggerHandler)==null||r.togglePeriodic(),this.refreshDisplay&&this.refreshDisplay()});this.plugin.settings.settings.triggers.enablePeriodicMovement&&new Ve(this.sectionContainer,"Periodic movement interval","Interval in minutes",d.PLACEHOLDER_TEXTS.INTERVAL,this.plugin.settings.settings.triggers.periodicMovementInterval.toString(),async i=>{var n;let r=parseInt(i);if(isNaN(r)){h(v("Interval must be a number"),"Periodic movement interval setting",!1);return}if(r<1){h(v("Interval must be greater than 0"),"Periodic movement interval setting",!1);return}this.plugin.settings.settings.triggers.periodicMovementInterval=r,await this.plugin.save_settings(),(n=this.plugin.triggerHandler)==null||n.togglePeriodic()})}};var R=class{constructor(e,t,i,r,n,s={}){this.settingItem=new W(e,t,i),this.settingItem.addClass("noteMover-mobile-button-setting");let o=this.settingItem.getControlElement();this.buttonEl=o.createEl("button",{cls:"noteMover-mobile-action-btn",text:r}),s.isPrimary?(this.buttonEl.addClass("mod-cta"),this.buttonEl.style.background="var(--interactive-accent)",this.buttonEl.style.color="var(--text-on-accent)"):(s.isWarning||s.isDanger)&&this.buttonEl.addClass("noteMover-mobile-delete-btn"),this.buttonEl.addEventListener("click",async()=>{await n()})}setButtonText(e){this.buttonEl.textContent=e}getButtonElement(){return this.buttonEl}getCardElement(){return this.settingItem.getCardElement()}};var _e=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i;this.filterInputs=[];this.sectionContainer=this.containerEl.createDiv({cls:"noteMover-mobile-section-container"})}render(){this.sectionContainer.empty();let e=this.sectionContainer.createDiv({cls:"noteMover-mobile-section-heading"});e.textContent="Filter";let t=this.sectionContainer.createDiv({cls:"noteMover-mobile-section-description"});t.textContent="Blacklist filters. Files matching any criteria will be excluded from movement.";let i=this.sectionContainer.createDiv({cls:"noteMover-mobile-filters-list-container"});this.renderFilters(i);let r=new R(this.sectionContainer,"",void 0,"Add new filter",async()=>{this.plugin.settings.settings.filters.filter.push({value:""}),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()},{isPrimary:!0})}moveFilter(e,t){let i=this.plugin.settings.settings.filters.filter;if(!i||i.length===0)return;let r=Math.max(0,Math.min(i.length-1,e+t));r!==e&&([i[e],i[r]]=[i[r],i[e]],this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay())}renderFilters(e){this.filterInputs=[],e.empty();let t=this.plugin.settings.settings.filters.filter;t.forEach((i,r)=>{let n=e.createDiv({cls:"noteMover-mobile-filter-card"}),s=n.createDiv({cls:"noteMover-mobile-input-label",text:`Filter ${r+1}`}),a=n.createDiv().createEl("input",{cls:"noteMover-mobile-text-input",type:"text",attr:{placeholder:d.PLACEHOLDER_TEXTS.FILTER,value:(i==null?void 0:i.value)||""}}),c=new N(this.plugin.app,a);a.addEventListener("input",async()=>{!a.value||a.value.trim()===""?t[r]={value:""}:t[r]={value:a.value},await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager()});let u=n.createDiv({cls:"noteMover-mobile-move-buttons-container"});r>0&&m.createMoveButton(u,"up",async()=>{this.moveFilter(r,-1)},!1),r<t.length-1&&m.createMoveButton(u,"down",async()=>{this.moveFilter(r,1)},!1),n.createEl("button",{cls:"noteMover-mobile-action-btn noteMover-mobile-delete-btn",text:"Delete"}).addEventListener("click",async()=>{t.splice(r,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()}),this.filterInputs.push({input:null,suggest:c})})}};var Be=class{constructor(e,t,i){this.cardEl=e.createDiv({cls:"noteMover-mobile-rule-card"}),this.headerEl=this.cardEl.createDiv({cls:"noteMover-mobile-rule-header"}),this.nameEl=this.headerEl.createDiv({cls:"noteMover-mobile-rule-name"}),this.nameEl.textContent=t.name||"Unnamed Rule",this.toggleEl=this.headerEl.createDiv({cls:"noteMover-mobile-rule-toggle"}),this.toggleInput=document.createElement("input"),this.toggleInput.type="checkbox",this.toggleInput.className="noteMover-mobile-toggle-input",this.toggleInput.checked=t.active,this.toggleEl.appendChild(this.toggleInput);let r=this.toggleEl.createDiv({cls:"noteMover-mobile-toggle-slider"});if(this.updateToggleState(t.active),this.toggleInput.addEventListener("change",async()=>{let n=this.toggleInput.checked;this.updateToggleState(n),i.onToggle&&await i.onToggle(n)}),this.toggleEl.addEventListener("click",n=>{n.target!==this.toggleInput&&this.toggleInput.click()}),this.actionsEl=this.cardEl.createDiv({cls:"noteMover-mobile-rule-actions"}),this.moveButtonsContainer=this.actionsEl.createDiv({cls:"noteMover-mobile-move-buttons-container"}),i.canMoveUp!==!1){let n=m.createMoveButton(this.moveButtonsContainer,"up",async()=>{i.onMoveUp&&await i.onMoveUp()},!1);n&&(this.moveUpButton=n)}if(i.canMoveDown!==!1){let n=m.createMoveButton(this.moveButtonsContainer,"down",async()=>{i.onMoveDown&&await i.onMoveDown()},!1);n&&(this.moveDownButton=n)}this.editButton=this.actionsEl.createEl("button",{cls:"noteMover-mobile-action-btn noteMover-mobile-edit-btn",text:"Edit"}),this.editButton.addEventListener("click",()=>{i.onEdit&&i.onEdit()}),this.deleteButton=this.actionsEl.createEl("button",{cls:"noteMover-mobile-action-btn noteMover-mobile-delete-btn",text:"Delete"}),this.deleteButton.addEventListener("click",async()=>{i.onDelete&&await i.onDelete()})}updateToggleState(e){e?this.toggleEl.addClass("is-active"):this.toggleEl.removeClass("is-active"),this.toggleInput.checked=e}setActive(e){this.toggleInput.checked=e,this.updateToggleState(e)}getCardElement(){return this.cardEl}},$e=class{constructor(e,t,i){this.cardEl=e.createDiv({cls:"noteMover-mobile-rule-card"});let r=this.cardEl.createDiv({cls:"noteMover-mobile-input-label",text:"Criteria"});this.criteriaInput=this.cardEl.createEl("input",{cls:"noteMover-mobile-text-input",type:"text",attr:{placeholder:"e.g., tag: #project",value:t.criteria||""}}),i.onCriteriaChange&&this.criteriaInput.addEventListener("input",async()=>{i.onCriteriaChange&&await i.onCriteriaChange(this.criteriaInput.value)});let n=this.cardEl.createDiv({cls:"noteMover-mobile-input-label",text:"Destination Path"});if(this.pathInput=this.cardEl.createEl("input",{cls:"noteMover-mobile-text-input",type:"text",attr:{placeholder:"e.g., Projects/",value:t.path||""}}),i.onPathChange&&this.pathInput.addEventListener("input",async()=>{i.onPathChange&&await i.onPathChange(this.pathInput.value)}),this.moveButtonsContainer=this.cardEl.createDiv({cls:"noteMover-mobile-move-buttons-container"}),i.canMoveUp!==!1){let s=m.createMoveButton(this.moveButtonsContainer,"up",async()=>{i.onMoveUp&&await i.onMoveUp()},!1);s&&(this.moveUpButton=s)}if(i.canMoveDown!==!1){let s=m.createMoveButton(this.moveButtonsContainer,"down",async()=>{i.onMoveDown&&await i.onMoveDown()},!1);s&&(this.moveDownButton=s)}this.deleteButton=this.cardEl.createEl("button",{cls:"noteMover-mobile-action-btn noteMover-mobile-delete-btn",text:"Delete"}),i.onDelete&&this.deleteButton.addEventListener("click",async()=>{i.onDelete&&await i.onDelete()})}getCriteriaValue(){return this.criteriaInput.value}getPathValue(){return this.pathInput.value}setCriteriaValue(e){this.criteriaInput.value=e}setPathValue(e){this.pathInput.value=e}getCardElement(){return this.cardEl}};var Ue=class{constructor(e,t,i){this.plugin=e;this.containerEl=t;this.refreshDisplay=i;this.ruleItems=[];this.sectionContainer=this.containerEl.createDiv({cls:"noteMover-mobile-section-container"})}render(){var s;this.sectionContainer.empty();let e=this.sectionContainer.createDiv({cls:"noteMover-mobile-section-heading"});e.textContent="Rules";let t=this.sectionContainer.createDiv({cls:"noteMover-mobile-section-description"});t.textContent="Move files to folders based on criteria. First matching rule applies.";let i=new z(this.sectionContainer,"Enable Rule-V2 (beta)","Advanced rule matching with multiple conditions",(s=this.plugin.settings.settings.enableRuleV2)!=null?s:!1,async o=>{this.plugin.settings.settings.enableRuleV2=o,await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()}),r=new R(this.sectionContainer,"",void 0,this.plugin.settings.settings.enableRuleV2?"+ Add Rule":"Add new rule",async()=>{this.plugin.settings.settings.enableRuleV2?this.openRuleEditorModal(null):(this.plugin.settings.settings.rules.push({criteria:"",path:""}),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay())},{isPrimary:!0}),n=this.sectionContainer.createDiv({cls:"noteMover-mobile-rules-list-container"});this.plugin.settings.settings.enableRuleV2?this.renderRulesV2(n):this.renderRulesV1(n)}moveRuleV2(e,t){let i=this.plugin.settings.settings.rulesV2;if(!i||i.length===0)return;let r=Math.max(0,Math.min(i.length-1,e+t));r!==e&&([i[e],i[r]]=[i[r],i[e]],this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay())}moveRuleV1(e,t){let i=this.plugin.settings.settings.rules;if(!i||i.length===0)return;let r=Math.max(0,Math.min(i.length-1,e+t));r!==e&&([i[e],i[r]]=[i[r],i[e]],this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay())}renderRulesV2(e){this.plugin.settings.settings.rulesV2||(this.plugin.settings.settings.rulesV2=[]),this.ruleItems=[];let t=this.plugin.settings.settings.rulesV2;t.forEach((i,r)=>{let n=new Be(e,i,{onToggle:async s=>{t[r].active=s,await this.plugin.save_settings()},onEdit:()=>{this.openRuleEditorModal(r)},onDelete:async()=>{confirm(`Delete rule "${i.name}"?

This cannot be undone.`)&&(t.splice(r,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay())},onMoveUp:async()=>{r>0&&this.moveRuleV2(r,-1)},onMoveDown:async()=>{r<t.length-1&&this.moveRuleV2(r,1)},canMoveUp:r>0,canMoveDown:r<t.length-1});this.ruleItems.push(n)})}renderRulesV1(e){this.ruleItems=[];let t=this.plugin.settings.settings.rules;t.forEach((i,r)=>{let n=new $e(e,i,{onCriteriaChange:async a=>{if(a&&t.some((c,u)=>u!==r&&c.criteria===a)){h(v("This criteria already has a folder associated with it"),"Rules setting",!1);return}t[r].criteria=a,await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager()},onPathChange:async a=>{t[r].path=a,await this.plugin.save_settings()},onDelete:async()=>{t.splice(r,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()},onMoveUp:async()=>{r>0&&this.moveRuleV1(r,-1)},onMoveDown:async()=>{r<t.length-1&&this.moveRuleV1(r,1)},canMoveUp:r>0,canMoveDown:r<t.length-1}),s=n.getCardElement().querySelector('input[type="text"]');s&&new N(this.plugin.app,s);let o=n.getCardElement().querySelectorAll('input[type="text"]');o.length>1&&new I(this.plugin.app,o[1]),this.ruleItems.push(n)})}openRuleEditorModal(e){let t=e!==null,i;t?i=JSON.parse(JSON.stringify(this.plugin.settings.settings.rulesV2[e])):i={name:"New Rule",destination:"",aggregation:"all",triggers:[{criteriaType:"tag",operator:"includes item",value:""}],active:!0},new oe(this.plugin.app,{rule:i,isEditMode:t,onSave:async n=>{this.plugin.settings.settings.rulesV2||(this.plugin.settings.settings.rulesV2=[]),t?this.plugin.settings.settings.rulesV2[e]=n:this.plugin.settings.settings.rulesV2.push(n),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()},onDelete:t?async()=>{this.plugin.settings.settings.rulesV2.splice(e,1),await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),this.refreshDisplay&&this.refreshDisplay()}:void 0}).open()}};var We=class{constructor(e,t){this.plugin=e;this.containerEl=t}render(){let e=this.containerEl.createDiv({cls:"noteMover-mobile-section-heading"});e.textContent="History",this.renderRetentionPolicy();let t=this.plugin.settings.settings.retentionPolicy||{...D.DEFAULT_RETENTION_POLICY};new R(this.containerEl,"Clean up old entries",`Remove entries older than ${t.value} ${t.unit}`,"Clean up now",async()=>{await this.plugin.historyManager.cleanupOldEntries()},{isPrimary:!0}),new R(this.containerEl,"Clear history","Clears the history of moved notes",d.UI_TEXTS.CLEAR_HISTORY,async()=>{await U.show(this.plugin.app,{title:d.UI_TEXTS.CLEAR_HISTORY_TITLE,message:d.UI_TEXTS.CLEAR_HISTORY_MESSAGE,confirmText:d.UI_TEXTS.CLEAR_HISTORY_CONFIRM,cancelText:d.UI_TEXTS.CLEAR_HISTORY_CANCEL,danger:!0})&&await this.plugin.historyManager.clearHistory()},{isWarning:!0})}renderRetentionPolicy(){this.plugin.settings.settings.retentionPolicy||(this.plugin.settings.settings.retentionPolicy={...D.DEFAULT_RETENTION_POLICY});let e=this.plugin.settings.settings.retentionPolicy,t=this.containerEl.createDiv({cls:"noteMover-mobile-setting-card"}),i=t.createDiv({cls:"noteMover-mobile-setting-title",text:d.UI_TEXTS.RETENTION_POLICY_TITLE}),r=t.createDiv({cls:"noteMover-mobile-setting-description",text:d.UI_TEXTS.RETENTION_POLICY_DESC}),n=t.createDiv({cls:"noteMover-mobile-retention-controls"}),s=n.createEl("input",{type:"text",cls:"noteMover-mobile-text-input",attr:{placeholder:"30",value:e.value.toString()}});s.addEventListener("input",async()=>{let p=parseInt(s.value);!isNaN(p)&&p>0&&(this.plugin.settings.settings.retentionPolicy.value=p,await this.plugin.save_settings(),r.textContent=`Remove entries older than ${p} ${e.unit}`)});let o=n.createEl("select",{cls:"noteMover-mobile-dropdown"}),a=o.createEl("option",{text:d.UI_TEXTS.RETENTION_POLICY_DAYS,attr:{value:"days"}}),c=o.createEl("option",{text:d.UI_TEXTS.RETENTION_POLICY_WEEKS,attr:{value:"weeks"}}),u=o.createEl("option",{text:d.UI_TEXTS.RETENTION_POLICY_MONTHS,attr:{value:"months"}});o.value=e.unit,o.addEventListener("change",async()=>{this.plugin.settings.settings.retentionPolicy.unit=o.value,await this.plugin.save_settings(),r.textContent=`Remove entries older than ${e.value} ${o.value}`})}};var Xe=class{constructor(e,t){this.plugin=e;this.containerEl=t}render(){let e=this.containerEl.createDiv({cls:"noteMover-mobile-section-heading"});e.textContent="Import/Export",new R(this.containerEl,"Export settings","Export your current settings as a JSON file",d.UI_TEXTS.EXPORT_SETTINGS,async()=>{await this.exportSettings()},{isPrimary:!0}),new R(this.containerEl,"Import settings","Import settings from a JSON file",d.UI_TEXTS.IMPORT_SETTINGS,async()=>{await this.importSettings()},{isWarning:!0})}async exportSettings(){try{let e={triggers:this.plugin.settings.settings.triggers,filters:this.plugin.settings.settings.filters,rules:this.plugin.settings.settings.rules,rulesV2:this.plugin.settings.settings.rulesV2,enableRuleV2:this.plugin.settings.settings.enableRuleV2,retentionPolicy:this.plugin.settings.settings.retentionPolicy},t=JSON.stringify(e,null,2),i=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(i),n=document.createElement("a");n.href=r,n.download=`note-mover-settings-${Date.now()}.json`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(r),g.success("Settings exported successfully")}catch(e){h(v("Failed to export settings",e),"Export settings",!1)}}async importSettings(){try{let e=document.createElement("input");e.type="file",e.accept=".json",e.style.display="none",e.addEventListener("change",async t=>{var r,n;let i=(r=t.target.files)==null?void 0:r[0];if(i)try{let s=await i.text(),o=JSON.parse(s),a=V.validateSettings(o);if(!a.isValid){g.error(`Invalid settings file: ${a.errors.join(", ")}`);return}if(!confirm("Import settings will replace your current settings. Continue?"))return;o.rules&&!o.rulesV2&&(o.rulesV2=P.migrateRules(o.rules)),this.plugin.settings.settings.triggers=o.triggers||this.plugin.settings.settings.triggers,this.plugin.settings.settings.filters=o.filters||this.plugin.settings.settings.filters,this.plugin.settings.settings.rules=o.rules||this.plugin.settings.settings.rules,this.plugin.settings.settings.rulesV2=o.rulesV2||this.plugin.settings.settings.rulesV2,this.plugin.settings.settings.enableRuleV2=(n=o.enableRuleV2)!=null?n:!1,this.plugin.settings.settings.retentionPolicy=o.retentionPolicy||this.plugin.settings.settings.retentionPolicy,await this.plugin.save_settings(),this.plugin.noteMover.updateRuleManager(),g.success("Settings imported successfully")}catch(s){h(v("Failed to import settings",s),"Import settings",!1)}finally{document.body.removeChild(e)}}),document.body.appendChild(e),e.click()}catch(e){h(v("Failed to open file picker",e),"Import settings",!1)}}};var Ye=class{constructor(e,t){this.plugin=e;this.containerEl=t}render(){this.containerEl.addClass("noteMover-mobile-settings-container"),this.containerEl.empty(),new He(this.plugin,this.containerEl,()=>this.render()).render(),new _e(this.plugin,this.containerEl,()=>this.render()).render(),new Ue(this.plugin,this.containerEl,()=>this.render()).render(),new We(this.plugin,this.containerEl).render(),new Xe(this.plugin,this.containerEl).render()}};var Ps=d.DEFAULT_SETTINGS,je=class extends mt.PluginSettingTab{constructor(t){super(t.app,t);this.plugin=t;this.debounceManager=new ue;let i=this.debounceManager.debounce("display",()=>this.display(),150);this.periodicMovementSettings=new re(t,this.containerEl,i),this.filterSettings=new ne(t,this.containerEl,i),this.rulesSettings=new ae(t,this.containerEl,i),this.historySettings=new le(t,this.containerEl),this.importExportSettings=new ce(t,this.containerEl,i)}display(){if(this.containerEl.empty(),m.addMobileClass(this.containerEl),m.isMobile()){new Ye(this.plugin,this.containerEl).render();return}this.cleanupExistingSections(),this.ensureArraysExist();let t=this.debounceManager.debounce("display",()=>this.display(),150);this.periodicMovementSettings=new re(this.plugin,this.containerEl,t),this.filterSettings=new ne(this.plugin,this.containerEl,t),this.rulesSettings=new ae(this.plugin,this.containerEl,t),this.historySettings=new le(this.plugin,this.containerEl),this.importExportSettings=new ce(this.plugin,this.containerEl,t),this.periodicMovementSettings.addTriggerSettings(),this.filterSettings.addFilterSettings(),this.rulesSettings.addRulesSetting(),this.rulesSettings.addRulesArray(),this.rulesSettings.addAddRuleButtonSetting(),this.historySettings.addHistorySettings(),this.importExportSettings.addImportExportSettings()}ensureArraysExist(){var t,i,r;Array.isArray((t=this.plugin.settings.settings)==null?void 0:t.rules)||(this.plugin.settings.settings=this.plugin.settings.settings||{},this.plugin.settings.settings.rules=[]),Array.isArray((r=(i=this.plugin.settings.settings)==null?void 0:i.filters)==null?void 0:r.filter)||(this.plugin.settings.settings=this.plugin.settings.settings||{},this.plugin.settings.settings.filters=this.plugin.settings.settings.filters||{},this.plugin.settings.settings.filters.filter=[])}validateSettings(){this.ensureArraysExist(),this.plugin.settings.settings.rules=this.plugin.settings.settings.rules.filter(t=>t&&t.criteria&&t.path&&t.criteria.trim()!==""&&t.path.trim()!==""),this.plugin.settings.settings.filters.filter=this.plugin.settings.settings.filters.filter.filter(t=>t&&typeof t.value=="string"&&t.value.trim()!=="")}cleanupExistingSections(){this.filterSettings&&typeof this.filterSettings.cleanup=="function"&&this.filterSettings.cleanup(),this.rulesSettings&&typeof this.rulesSettings.cleanup=="function"&&this.rulesSettings.cleanup()}cleanup(){this.debounceManager.cancelAll(),this.cleanupExistingSections()}};var Ge=class{constructor(e){this.plugin=e;this.history=[];this.bulkOperations=[];this.isPluginMove=!1;this.currentBulkOperationId=null;this.currentBulkOperationType=null}loadHistoryFromSettings(){let e=this.plugin.settings.history;e&&Array.isArray(e.history)?this.history=e.history:this.history=[],e&&Array.isArray(e.bulkOperations)?this.bulkOperations=e.bulkOperations:this.bulkOperations=[]}async saveHistory(){let e=this.plugin.settings,t=e.history;(!t||typeof t!="object"||Array.isArray(t))&&(e.history={history:[],bulkOperations:[]}),Array.isArray(e.history.history)||(e.history.history=[]),Array.isArray(e.history.bulkOperations)||(e.history.bulkOperations=[]),e.history.history=this.history,e.history.bulkOperations=this.bulkOperations,await this.plugin.save_settings()}addEntry(e){let t=Date.now(),i={...e,id:crypto.randomUUID(),timestamp:t,bulkOperationId:this.currentBulkOperationId||void 0,operationType:this.currentBulkOperationType||"single"};if(this.history.unshift(i),this.currentBulkOperationId){let r=this.bulkOperations.find(n=>n.id===this.currentBulkOperationId);r&&(r.entries.push(i),r.totalFiles=r.entries.length)}this.history.length>D.MAX_HISTORY_ENTRIES&&this.history.pop(),this.saveHistory()}markPluginMoveStart(){this.isPluginMove=!0}markPluginMoveEnd(){this.isPluginMove=!1}addEntryFromVaultEvent(e,t,i){if(this.isPluginMove)return;let r=Q(e),n=Q(t);r===n||this.history.find(o=>o.fileName===i&&o.destinationPath===t&&Math.abs(Date.now()-o.timestamp)<D.DUPLICATE_CHECK_WINDOW_MS)||this.addEntry({sourcePath:e,destinationPath:t,fileName:i})}getHistory(){return[...this.history]}getFilteredHistory(e="all"){if(e==="all")return this.getHistory();let t=Date.now(),i;switch(e){case"today":let r=new Date;r.setHours(0,0,0,0),i=r.getTime();break;case"week":let n=new Date,s=n.getDay(),o=s===0?6:s-1;n.setDate(n.getDate()-o),n.setHours(0,0,0,0),i=n.getTime();break;case"month":let a=new Date;a.setDate(1),a.setHours(0,0,0,0),i=a.getTime();break;default:return this.getHistory()}return this.history.filter(r=>r.timestamp>=i)}getFilteredBulkOperations(e="all"){if(e==="all")return this.getBulkOperations();let t=Date.now(),i;switch(e){case"today":let r=new Date;r.setHours(0,0,0,0),i=r.getTime();break;case"week":let n=new Date,s=n.getDay(),o=s===0?6:s-1;n.setDate(n.getDate()-o),n.setHours(0,0,0,0),i=n.getTime();break;case"month":let a=new Date;a.setDate(1),a.setHours(0,0,0,0),i=a.getTime();break;default:return this.getBulkOperations()}return this.bulkOperations.filter(r=>r.timestamp>=i)}async cleanupOldEntries(){var o;let e=((o=this.plugin.settings.settings)==null?void 0:o.retentionPolicy)||D.DEFAULT_RETENTION_POLICY,t=this.calculateRetentionCutoffTime(e),i=this.history.length;this.history=this.history.filter(a=>a.timestamp>=t);let r=i-this.history.length,n=this.bulkOperations.length;this.bulkOperations=this.bulkOperations.filter(a=>a.timestamp>=t);let s=n-this.bulkOperations.length;(r>0||s>0)&&(await this.saveHistory(),g.info(`Cleaned up ${r} history entries and ${s} bulk operations older than ${e.value} ${e.unit}`))}calculateRetentionCutoffTime(e){let t=Date.now(),i;switch(e.unit){case"days":i=e.value*24*60*60*1e3;break;case"weeks":i=e.value*7*24*60*60*1e3;break;case"months":i=e.value*30*24*60*60*1e3;break;default:i=720*60*60*1e3}return t-i}async undoEntry(e){let t=this.history.findIndex(s=>s.id===e);if(t===-1)return!1;let i=this.history[t],r=this.plugin.app.vault.getAbstractFileByPath(i.destinationPath);if(!r)return h(v(`File not found at path: ${i.destinationPath}`),"undoEntry",!1),!1;let n=Q(i.sourcePath);if(n&&!await ee(this.plugin.app,n))return h(v(`Failed to create source folder ${n}`),"undoEntry",!1),!1;try{if(this.markPluginMoveStart(),await this.plugin.app.fileManager.renameFile(r,i.sourcePath),this.history.splice(t,1),i.bulkOperationId){let s=this.bulkOperations.find(o=>o.id===i.bulkOperationId);if(s&&(s.entries=s.entries.filter(o=>o.id!==e),s.totalFiles=s.entries.length,s.entries.length===0)){let o=this.bulkOperations.findIndex(a=>a.id===i.bulkOperationId);o!==-1&&this.bulkOperations.splice(o,1)}}return await this.saveHistory(),!0}catch(s){return h(s,"Error during undo operation",!1),!1}finally{this.markPluginMoveEnd()}}getLastEntryForFile(e){return this.history.find(t=>t.fileName===e)}async undoLastMove(e){let t=this.getLastEntryForFile(e);if(!t)return h(v(`No history entry found for file: ${e}`),"undoLastMove",!1),!1;let i=this.plugin.app.vault.getAbstractFileByPath(t.destinationPath);if(!i)return h(v(`File not found at path: ${t.destinationPath}`),"undoLastMove",!1),!1;let r=Q(t.sourcePath);if(r&&!await ee(this.plugin.app,r))return h(v(`Failed to create source folder ${r}`),"undoLastMove",!1),!1;try{g.info(`Attempting to move file from ${t.destinationPath} to ${t.sourcePath}`),this.markPluginMoveStart(),await this.plugin.app.fileManager.renameFile(i,t.sourcePath);let n=this.history.findIndex(s=>s.id===t.id);return n!==-1&&(this.history.splice(n,1),await this.saveHistory()),g.success("Move successful"),!0}catch(n){return h(n,"Error during undo",!1),!1}finally{this.markPluginMoveEnd()}}async clearHistory(){this.history=[],this.bulkOperations=[],await this.saveHistory()}startBulkOperation(e){let t=crypto.randomUUID();this.currentBulkOperationId=t,this.currentBulkOperationType=e;let i={id:t,operationType:e==="single"?"bulk":e,timestamp:Date.now(),entries:[],totalFiles:0};return this.bulkOperations.unshift(i),this.bulkOperations.length>D.MAX_BULK_OPERATIONS&&this.bulkOperations.pop(),t}endBulkOperation(){if(this.currentBulkOperationId){let e=this.bulkOperations.find(t=>t.id===this.currentBulkOperationId);if(e&&e.entries.length===0){let t=this.bulkOperations.indexOf(e);this.bulkOperations.splice(t,1)}}this.currentBulkOperationId=null,this.currentBulkOperationType=null,this.saveHistory()}getBulkOperations(){return[...this.bulkOperations]}async undoBulkOperation(e){let t=this.bulkOperations.find(s=>s.id===e);if(!t)return h(v(`Bulk operation with ID ${e} not found`),"undoBulkOperation",!1),!1;g.info(`Starting bulk undo for operation: ${t.id}, ${t.entries.length} entries`);let i=[],r=[...t.entries].sort((s,o)=>o.timestamp-s.timestamp);for(let s of r){g.info(`Attempting to undo: ${s.fileName} from ${s.destinationPath} to ${s.sourcePath}`);let o=this.plugin.app.vault.getAbstractFileByPath(s.destinationPath);if(!o){h(v(`File not found at destination path: ${s.destinationPath}`),"undoBulkOperation",!1),i.push(!1);continue}let a=Q(s.sourcePath);if(a&&!await ee(this.plugin.app,a)){h(v(`Failed to create source folder ${a}`),"undoBulkOperation",!1),i.push(!1);continue}try{this.markPluginMoveStart(),await this.plugin.app.fileManager.renameFile(o,s.sourcePath),g.success(`Successfully moved ${s.fileName} back to ${s.sourcePath}`);let c=this.history.findIndex(u=>u.id===s.id);c!==-1&&this.history.splice(c,1),i.push(!0)}catch(c){h(c,`Error undoing move for ${s.fileName}`,!1),i.push(!1)}finally{this.markPluginMoveEnd()}}let n=i.filter(s=>s).length;if(g.info(`Bulk undo completed: ${n}/${i.length} successful`),n>0){let s=new Set;r.forEach((a,c)=>{i[c]&&s.add(a.id)});let o=t.entries.filter(a=>!s.has(a.id));if(o.length===0){let a=this.bulkOperations.findIndex(c=>c.id===e);a!==-1&&this.bulkOperations.splice(a,1)}else t.entries=o,t.totalFiles=o.length}return await this.saveHistory(),i.every(s=>s)}};var ft=require("obsidian");var qe=class{constructor(e){this.plugin=e;this.periodicIntervalId=null;this.onEditUnregister=null;this.debounceManager=new ue,this.debouncedHandleOnEdit=this.debounceManager.debounce("onEdit",async t=>{try{await this.handleOnEdit(t)}catch(i){console.error("Error in debounced handleOnEdit:",i)}},2e3)}togglePeriodic(){if(this.periodicIntervalId&&(window.clearInterval(this.periodicIntervalId),this.periodicIntervalId=null),this.plugin.settings.settings.triggers.enablePeriodicMovement){let e=this.plugin.settings.settings.triggers.periodicMovementInterval;this.periodicIntervalId=window.setInterval(async()=>{await this.plugin.noteMover.moveAllFilesInVaultPeriodic()},e*(60*1e3))}}toggleOnEditListener(){this.onEditUnregister&&(this.onEditUnregister(),this.onEditUnregister=null),this.debounceManager.cancel("onEdit"),this.plugin.settings.settings.triggers.enableOnEditTrigger&&(this.plugin.registerEvent(this.plugin.app.vault.on("modify",async e=>{e instanceof ft.TFile&&e.extension==="md"&&this.debouncedHandleOnEdit(e)})),this.onEditUnregister=()=>{})}async handleOnEdit(e){await this.plugin.noteMover.moveFileBasedOnTags(e,"/",!1)}cleanup(){this.debounceManager.cancelAll()}};var vt=require("obsidian");var ze=class extends x{constructor(e,t,i,r,n={}){super(e,{title:`NoteMover updated to version ${t}!`,titleIcon:"\u{1F389}",cssClass:"note-mover-update-modal",size:"medium",...n}),this.currentVersion=t,this.lastSeenVersion=i,this.changelogEntries=r}createContent(){let{contentEl:e}=this;this.lastSeenVersion?e.createEl("p",{text:`What's new since version ${this.lastSeenVersion}?`,cls:"noteMover-modal-subtitle"}):e.createEl("p",{text:"Here are the latest changes:",cls:"noteMover-modal-subtitle"});let t=m.isMobile(),i=e.createEl("div",{cls:t?"noteMover-changelog-container noteMover-changelog-container-mobile":"noteMover-changelog-container"});this.changelogEntries.length===0?i.createEl("p",{text:"No specific changelog information available.",cls:"noteMover-no-changelog-text"}):this.renderChangelog(i);let r=e.createEl("div",{cls:t?"noteMover-modal-footer noteMover-modal-footer-mobile":"noteMover-modal-footer"}),s=r.createEl("div",{cls:t?"noteMover-update-modal-links noteMover-update-modal-links-mobile":"noteMover-update-modal-links"}).createEl("a",{text:"View full changelog on GitHub",href:"https://github.com/bueckerlars/obsidian-note-mover-shortcut/releases",cls:t?"noteMover-update-modal-github-link noteMover-update-modal-github-link-mobile":"noteMover-update-modal-github-link"});if(s.setAttribute("target","_blank"),t&&(s.style.minHeight="48px",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.padding="12px"),t){let a=new vt.Setting(r).addButton(c=>{c.setButtonText("Close").setCta().onClick(()=>{this.close()})}).settingEl.querySelector("button");a&&(a.style.width="100%",a.style.minHeight="48px")}else{let o=this.createButtonContainer(r);this.createButton(o,"Close",()=>{this.close()},{isPrimary:!0})}}renderChangelog(e){let t=m.isMobile();this.changelogEntries.forEach(i=>{let r=e.createEl("div",{cls:t?"noteMover-changelog-version noteMover-changelog-version-mobile":"noteMover-changelog-version"});if(r.createEl("h3",{text:`Version ${i.version}`,cls:"noteMover-changelog-version-title"}),i.changes.features&&i.changes.features.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u2728 New Features",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.features.forEach(o=>{s.createEl("li",{text:o})})}if(i.changes.improvements&&i.changes.improvements.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u26A1 Improvements",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.improvements.forEach(o=>{s.createEl("li",{text:o})})}if(i.changes.bugFixes&&i.changes.bugFixes.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u{1F41B} Bug Fixes",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.bugFixes.forEach(o=>{s.createEl("li",{text:o})})}if(i.changes.changes&&i.changes.changes.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u{1F504} Changes",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.changes.forEach(o=>{s.createEl("li",{text:o})})}if(i.changes.fixes&&i.changes.fixes.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u{1F527} Fixes",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.fixes.forEach(o=>{s.createEl("li",{text:o})})}if(i.changes.performance&&i.changes.performance.length>0){let n=r.createEl("div",{cls:"noteMover-changelog-section"});n.createEl("h4",{text:"\u26A1 Performance",cls:"noteMover-changelog-section-title"});let s=n.createEl("ul",{cls:"noteMover-changelog-list"});i.changes.performance.forEach(o=>{s.createEl("li",{text:o})})}})}onClose(){super.onClose()}};var yt=[{version:"0.5.7",changes:{fixes:["Fixed rule validation"]}},{version:"0.5.6",changes:{improvements:["**Mobile-First Redesign of RuleEditorModal**: Complete mobile optimization of the rule editor modal"]}},{version:"0.5.5",changes:{fixes:["Fixed CSS selectors overwriting global Obsidian styles [#48](https://github.com/bueckerlars/obsidian-note-mover-shortcut/issues/48)"]}},{version:"0.5.4",changes:{fixes:["Refactored mobile styles and classes for improved consistency"]}},{version:"0.5.3",changes:{fixes:["Fixed RuleV2 toggle on mobile not updating the active rule manager"]}},{version:"0.5.2",changes:{features:["**Conflict Resolution**: Prevent file overwriting when target file already exists [#25](https://github.com/bueckerlars/obsidian-note-mover-shortcut/issues/25)","Enhanced mobile UI responsiveness with optimized layouts for all modals"],improvements:["Added automatic scroll position reset when modals open","Implemented mobile detection utilities for consistent mobile experience","Enhanced modal sizing with mobile-specific full-width layout","Improved accessibility with larger touch targets and better spacing on mobile devices"]}},{version:"0.5.1",changes:{features:["Improved UI responsiveness [#48](https://github.com/bueckerlars/obsidian-note-mover-shortcut/issues/48)"]}},{version:"0.5.0",changes:{features:["**RuleV2 System (Beta)**: Complete rewrite of the rule matching system with advanced trigger-based logic"],changes:["**Metadata Extraction**: Enhanced `MetadataExtractor` with V2-specific fields (`extension`, `links`, `embeds`, `headings`)","**Rule Management**: New `RuleManagerV2` class with advanced preview and validation capabilities","**Type Safety**: Full TypeScript type safety with CriteriaType-to-Operator mapping","**Error Handling**: Graceful handling of invalid regex patterns and malformed data"]}},{version:"0.4.7",changes:{features:[],changes:["Marked NoteMoverSettings interface as deprecated","Refactoring to use the new PluginData interface"],fixes:["Fixed SettingsValidator to accept both deprecated and new settings data structure","Enabled notifications on periodic movements","Improved performance of On-Edit Trigger"]}},{version:"0.4.6",changes:{features:["Added `Add current file to blacklist` command.","Added new action button on history entries to add the file to blacklist"],changes:["Removed `FilerMode` setting and reworked filter logic to work always if mode is set to blacklist"]}},{version:"0.4.5",changes:{fixes:["Rule Matching: RuleMatcher now leverages MetadataExtractor to support list-property matching via parseListProperty/isListProperty.","Debounced Rendering: Introduce DebounceManager; SettingsTab refreshes via debounced display() and provides cleanup().","Memory Safety: FilterSettingsSection/RulesSettingsSection track AdvancedSuggest instances and DragDropManager; added cleanup() and proper refresh after DnD save."]}},{version:"0.4.4",changes:{features:["Implemented check if note is in the correct folder already before move","Implemented drag&drop reordering for rules and filters"],bugFixes:["Fixed skipping of already moved files","Fixed filter blacklist for folders [#33](https://github.com/bueckerlars/obsidian-note-mover-shortcut/issues/33)"]}},{version:"0.4.3",changes:{changes:["Removed `onlyMoveNotesWithRules` setting"],fixes:["Bulk moves skip notes that are in the correct folder already"],improvements:["The `UpdateMangager` gets a dynamic on build-time generated changelog instead of a copy from the `CHANGELOG.md`"]}},{version:"0.4.2",changes:{features:['Added an option for "on-edit" note movement',"Changed the filter whitelist/blacklist toggle to a dropdown","Renamed the periodic movement settings section to trigger section","Implemented an event system for periodic movements and on-edit movement"]}},{version:"0.4.1",changes:{changes:["Removed inbox and notes folder settings","Added setting for history rentention policy and dropdown in the history modal to select timespan of the entries shown"]}},{version:"0.4.0",changes:{features:["Added a button for opening notes in the `History Modal`","Added Wildcard and Regex matching for filenames in the rules","Added Settings for importing and exporting settings"],changes:["Implemented comprehensive codebase refactoring for improved maintainability and performance","Added new `FileMovementService` class for unified file movement operations","Introduced `MetadataExtractor` class for standardized file metadata access","Created new `RuleMatcher` class for advanced rule and filter matching","Added `BaseModal` class for consistent modal UI across the plugin","Implemented `NoticeManager` class for unified notification system"],improvements:["Refactored all modal classes to extend `BaseModal` for consistency","Enhanced error handling with standardized error creation and management","Improved test coverage with comprehensive unit tests for new classes","Added configuration constants for better maintainability","Optimized suggestion systems with improved metadata extraction","Enhanced path utilities with new helper functions","Improved code organization and separation of concerns"],bugFixes:["Fixed various edge cases in file movement operations","Improved error handling for folder creation failures","Enhanced undo functionality for complex file operations","Fixed issues with metadata extraction in edge cases"]}},{version:"0.3.4",changes:{features:['Added "Only move notes with rules" option #21'],improvements:["Enhanced rule processing logic to support selective note movement","Updated preview functionality to reflect the new movement behavior","Improved user experience with clear option descriptions and conditional UI display"]}},{version:"0.3.3",changes:{features:["Implemented file move preview functionality to show which files will be moved before execution","Added bulk undo functionality to history for reverting multiple movements at once","Added custom confirmation modal"],bugFixes:["Fixed bug where undo was failing with notes that are moved to subfolders by rules","Small styling fixes for preview modal"],improvements:["Enhanced test coverage and improved mock data in tests"]}},{version:"0.3.2",changes:{features:["Added support for Properties (Frontmatter) in Rules and Filters #20","Enhanced property suggestions with three-level autocomplete"],improvements:["Extended AdvancedSuggest with comprehensive property value tracking","Updated UI placeholders and descriptions to include property examples","Added comprehensive test coverage for property-based functionality"]}},{version:"0.3.1",changes:{features:["Implemented support for subtags in rules #19","Implemented creation of destination folders that do not exist when moving notes"]}},{version:"0.3.0",changes:{features:["Implemented update modal that shows changelog information for new versions","Added advanced filter system with intelligent suggestors for folders and tags","Implemented advanced suggest system for rule settings","Added automatic history event listener for tracking manual file operations","Command to manually show update modal for viewing changelog"],improvements:["Refactored rule code to make iterations and maintenance easier","Improved test coverage and updated test implementation for new filter settings","Enhanced user experience with better autocomplete suggestions"]}},{version:"0.2.1",changes:{bugFixes:["Fixed config gets overwrited on history changes #17"]}},{version:"0.2.0",changes:{features:["Implemented movement history","Added modal to show the history and revert movements","Added Notice for single move command with undo option"]}},{version:"0.1.7",changes:{bugFixes:["Fixed issues mentioned in PR obsidianmd/obsidian-releases#6028"]}},{version:"0.1.6",changes:{bugFixes:["Removed path import for mobile support","Refactored suggestors with AbstractInputSuggest","Use getAllTags() method for getting tags to insure tags are used from file and frontmatter","Fixed UI texts with sentece case","Removed use of innerHTML from log functions"]}},{version:"0.1.5",changes:{features:["Added periodic movement options to settings","Implemented timer function","Added filter options to settings","Added heading to periodic movement setting","Implemented filter setting","Added periodic movement enabled on plugin startup"],bugFixes:["Fixed skip if whitelist and no tags","Fixed filter code and added skip option for manuell note movement","Fixed typo in settings","Fixed interaval reset"]}},{version:"0.1.4",changes:{features:["Added rules section to settings","Added TagSuggest","Implemented note movement based on rules","Updated README with updated description","Added custom log classes"]}},{version:"0.1.3",changes:{bugFixes:["Renamed setting for notes folder","Set default value for notes folder to vault root"],features:["Added inbox folder setting","Added command to move all files from inbox to notes folder"]}}];var Ke=class{constructor(e){this.plugin=e}async checkForUpdates(){let e=this.plugin.manifest.version,t=this.plugin.settings.lastSeenVersion;(!t||this.isNewerVersion(e,t))&&await this.showUpdateModal()}async showUpdateModal(e=!1){let t=this.plugin.manifest.version,i=this.plugin.settings.lastSeenVersion;e&&i===t&&(i="0.4.7");let r=await this.getRelevantChangelogEntries(i,t);new ze(this.plugin.app,t,i||"",r).open(),e||(this.plugin.settings.lastSeenVersion=t,await this.plugin.save_settings())}isNewerVersion(e,t){let i=o=>o.split(".").map(a=>parseInt(a)||0),r=i(e),n=i(t),s=Math.max(r.length,n.length);for(;r.length<s;)r.push(0);for(;n.length<s;)n.push(0);for(let o=0;o<s;o++){if(r[o]>n[o])return!0;if(r[o]<n[o])return!1}return!1}async getRelevantChangelogEntries(e,t){try{return this.filterChangelogEntries(yt,e,t)}catch(i){return g.error(`Fehler beim Laden des Changelogs: ${i instanceof Error?i.message:String(i)}`),[]}}filterChangelogEntries(e,t,i){return e.filter(r=>this.shouldIncludeVersion(r.version,t,i))}shouldIncludeVersion(e,t,i){return e===i?!0:t?this.isNewerVersion(e,t)&&(e===i||this.isNewerVersion(i,e)):["0.5.0","0.4.6","0.4.5","0.4.4","0.4.3","0.4.2","0.4.1","0.4.0","0.3.5","0.3.4","0.3.3","0.3.0","0.2.1","0.2.0","0.1.7","0.1.6"].includes(e)}};var Je=class extends Ze.Plugin{async onload(){await this.load_settings(),this.historyManager=new Ge(this),this.historyManager.loadHistoryFromSettings(),this.updateManager=new Ke(this),this.noteMover=new xe(this),this.triggerHandler=new qe(this),this.command_handler=new Pe(this),this.command_handler.setup(),this.addRibbonIcon("book-plus","NoteMover",e=>{this.noteMover.moveFocusedNoteToDestination()}),this.settingTab=new je(this),this.addSettingTab(this.settingTab),this.triggerHandler.togglePeriodic(),this.triggerHandler.toggleOnEditListener(),this.setupVaultEventListeners(),this.app.workspace.onLayoutReady(()=>{this.updateManager.checkForUpdates()})}onunload(){this.settingTab&&this.settingTab.cleanup(),this.triggerHandler&&this.triggerHandler.cleanup()}setupVaultEventListeners(){this.registerEvent(this.app.vault.on("rename",(e,t)=>{e instanceof Ze.TFile&&e.extension==="md"&&this.historyManager.addEntryFromVaultEvent(t,e.path,e.name)}))}async save_settings(){let e=this.settings,t=e.history;(!t||typeof t!="object"||Array.isArray(t))&&(e.history={history:[],bulkOperations:[]}),Array.isArray(e.history.history)||(e.history.history=[]),Array.isArray(e.history.bulkOperations)||(e.history.bulkOperations=[]),await this.saveData(this.settings)}async load_settings(){let e=await this.loadData();this.isPluginData(e)?this.settings=e:(await this.backupLegacyDataJson(),this.settings=this.migrateFromLegacy(e||{}),await this.save_settings()),await this.validateSettings()}async validateSettings(){if(this.settings.settings||(this.settings.settings=this.buildDefaultSettingsData()),this.settings.history||(this.settings.history={history:[],bulkOperations:[]}),Array.isArray(this.settings.settings.rules)||(this.settings.settings.rules=[]),this.settings.settings.filters||(this.settings.settings.filters={filter:[]}),Array.isArray(this.settings.settings.filters.filter)||(this.settings.settings.filters.filter=[]),this.settings.settings.enableRuleV2===void 0&&(this.settings.settings.enableRuleV2=!1),Array.isArray(this.settings.settings.rulesV2)||(this.settings.settings.rulesV2=[]),this.settings.schemaVersion===void 0&&(this.settings.schemaVersion=1),this.settings.settings.rules=this.settings.settings.rules.filter(e=>e&&e.criteria&&e.path&&e.criteria.trim()!==""&&e.path.trim()!==""),this.settings.settings.filters.filter=this.settings.settings.filters.filter.filter(e=>e&&typeof e.value=="string"&&e.value.trim()!==""),this.settings.settings.enableRuleV2&&(P.shouldMigrate(this.settings.settings.rules,this.settings.settings.rulesV2)&&(console.log("Migrating Rule V1 to Rule V2..."),this.settings.settings.rulesV2=P.migrateRules(this.settings.settings.rules),console.log(`Migrated ${this.settings.settings.rulesV2.length} rules to V2 format`),await this.save_settings()),this.settings.settings.rulesV2&&this.settings.settings.rulesV2.length>0&&P.migrateRuleV2Triggers(this.settings.settings.rulesV2)&&(console.log("Migrated RuleV2 triggers from ruleType to operator format"),await this.save_settings())),this.settings.settings.rulesV2&&this.settings.settings.rulesV2.length>0){let e={isValid:!0,errors:[],warnings:[]};V.validateRulesV2Array(this.settings.settings.rulesV2,e),e.errors.length>0&&console.error("RuleV2 validation errors:",e.errors),e.warnings.length>0&&console.warn("RuleV2 validation warnings:",e.warnings)}}isPluginData(e){return e&&typeof e=="object"&&"settings"in e&&e.settings&&"history"in e&&e.history}buildDefaultSettingsData(){var t;let e=d.DEFAULT_SETTINGS;return{triggers:{enablePeriodicMovement:!!e.enablePeriodicMovement,periodicMovementInterval:(t=e.periodicMovementInterval)!=null?t:5,enableOnEditTrigger:!!e.enableOnEditTrigger},filters:{filter:Array.isArray(e.filter)?e.filter.map(i=>({value:i})):[]},rules:Array.isArray(e.rules)?e.rules:[],retentionPolicy:e.retentionPolicy,enableRuleV2:!1,rulesV2:[]}}migrateFromLegacy(e){var M,E,S,f,O,H,K;let t=d.DEFAULT_SETTINGS,i=(E=(M=e==null?void 0:e.enablePeriodicMovement)!=null?M:t.enablePeriodicMovement)!=null?E:!1,r=(f=(S=e==null?void 0:e.periodicMovementInterval)!=null?S:t.periodicMovementInterval)!=null?f:5,n=(H=(O=e==null?void 0:e.enableOnEditTrigger)!=null?O:t.enableOnEditTrigger)!=null?H:!1,s=(K=e==null?void 0:e.retentionPolicy)!=null?K:t.retentionPolicy,o=Array.isArray(e==null?void 0:e.rules)?e.rules:[],c=(Array.isArray(e==null?void 0:e.filter)?e.filter:[]).filter(pe=>typeof pe=="string").map(pe=>({value:pe})),u=Array.isArray(e==null?void 0:e.history)?e.history:[],p=Array.isArray(e==null?void 0:e.bulkOperations)?e.bulkOperations:[];return{settings:{triggers:{enablePeriodicMovement:i,periodicMovementInterval:r,enableOnEditTrigger:n},filters:{filter:c},rules:o,retentionPolicy:s,enableRuleV2:!1},history:{history:u,bulkOperations:p},lastSeenVersion:e==null?void 0:e.lastSeenVersion,schemaVersion:1}}async backupLegacyDataJson(){var e;try{let t=this.app.vault.configDir||".obsidian",i=this.app.vault.adapter,r=`${t}/plugins/${this.manifest.id}/data.json`;if(!await((e=i.exists)==null?void 0:e.call(i,r)))return;let s=new Date().toISOString().replace(/[:.]/g,"-"),o=`${t}/plugins/${this.manifest.id}/data.backup.${s}.json`,a=await i.read(r);await i.write(o,a)}catch(t){}}};

/* nosourcemap */